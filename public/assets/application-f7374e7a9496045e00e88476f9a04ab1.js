/*
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */
/*
 * Configurable variables. You may need to tweak these to be compatible with
 * the server-side, but the defaults work in most cases.
 */
function hex_md5(e){return rstr2hex(rstr_md5(str2rstr_utf8(e)))}function b64_md5(e){return rstr2b64(rstr_md5(str2rstr_utf8(e)))}function any_md5(e,t){return rstr2any(rstr_md5(str2rstr_utf8(e)),t)}function hex_hmac_md5(e,t){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)))}function b64_hmac_md5(e,t){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)))}function any_hmac_md5(e,t,n){return rstr2any(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)),n)}function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function rstr_md5(e){return binl2rstr(binl_md5(rstr2binl(e),e.length*8))}function rstr_hmac_md5(e,t){var n=rstr2binl(e);n.length>16&&(n=binl_md5(n,e.length*8));var r=Array(16),i=Array(16);for(var s=0;s<16;s++)r[s]=n[s]^909522486,i[s]=n[s]^1549556828;var o=binl_md5(r.concat(rstr2binl(t)),512+t.length*8);return binl2rstr(binl_md5(i.concat(o),640))}function rstr2hex(e){try{hexcase}catch(t){hexcase=0}var n=hexcase?"0123456789ABCDEF":"0123456789abcdef",r="",i;for(var s=0;s<e.length;s++)i=e.charCodeAt(s),r+=n.charAt(i>>>4&15)+n.charAt(i&15);return r}function rstr2b64(e){try{b64pad}catch(t){b64pad=""}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",i=e.length;for(var s=0;s<i;s+=3){var o=e.charCodeAt(s)<<16|(s+1<i?e.charCodeAt(s+1)<<8:0)|(s+2<i?e.charCodeAt(s+2):0);for(var u=0;u<4;u++)s*8+u*6>e.length*8?r+=b64pad:r+=n.charAt(o>>>6*(3-u)&63)}return r}function rstr2any(e,t){var n=t.length,r,i,s,o,u,a=Array(Math.ceil(e.length/2));for(r=0;r<a.length;r++)a[r]=e.charCodeAt(r*2)<<8|e.charCodeAt(r*2+1);var f=Math.ceil(e.length*8/(Math.log(t.length)/Math.log(2))),l=Array(f);for(i=0;i<f;i++){u=Array(),o=0;for(r=0;r<a.length;r++){o=(o<<16)+a[r],s=Math.floor(o/n),o-=s*n;if(u.length>0||s>0)u[u.length]=s}l[i]=o,a=u}var c="";for(r=l.length-1;r>=0;r--)c+=t.charAt(l[r]);return c}function str2rstr_utf8(e){var t="",n=-1,r,i;while(++n<e.length)r=e.charCodeAt(n),i=n+1<e.length?e.charCodeAt(n+1):0,55296<=r&&r<=56319&&56320<=i&&i<=57343&&(r=65536+((r&1023)<<10)+(i&1023),n++),r<=127?t+=String.fromCharCode(r):r<=2047?t+=String.fromCharCode(192|r>>>6&31,128|r&63):r<=65535?t+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|r&63):r<=2097151&&(t+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|r&63));return t}function str2rstr_utf16le(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)&255,e.charCodeAt(n)>>>8&255);return t}function str2rstr_utf16be(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)>>>8&255,e.charCodeAt(n)&255);return t}function rstr2binl(e){var t=Array(e.length>>2);for(var n=0;n<t.length;n++)t[n]=0;for(var n=0;n<e.length*8;n+=8)t[n>>5]|=(e.charCodeAt(n/8)&255)<<n%32;return t}function binl2rstr(e){var t="";for(var n=0;n<e.length*32;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function binl_md5(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;var n=1732584193,r=-271733879,i=-1732584194,s=271733878;for(var o=0;o<e.length;o+=16){var u=n,a=r,f=i,l=s;n=md5_ff(n,r,i,s,e[o+0],7,-680876936),s=md5_ff(s,n,r,i,e[o+1],12,-389564586),i=md5_ff(i,s,n,r,e[o+2],17,606105819),r=md5_ff(r,i,s,n,e[o+3],22,-1044525330),n=md5_ff(n,r,i,s,e[o+4],7,-176418897),s=md5_ff(s,n,r,i,e[o+5],12,1200080426),i=md5_ff(i,s,n,r,e[o+6],17,-1473231341),r=md5_ff(r,i,s,n,e[o+7],22,-45705983),n=md5_ff(n,r,i,s,e[o+8],7,1770035416),s=md5_ff(s,n,r,i,e[o+9],12,-1958414417),i=md5_ff(i,s,n,r,e[o+10],17,-42063),r=md5_ff(r,i,s,n,e[o+11],22,-1990404162),n=md5_ff(n,r,i,s,e[o+12],7,1804603682),s=md5_ff(s,n,r,i,e[o+13],12,-40341101),i=md5_ff(i,s,n,r,e[o+14],17,-1502002290),r=md5_ff(r,i,s,n,e[o+15],22,1236535329),n=md5_gg(n,r,i,s,e[o+1],5,-165796510),s=md5_gg(s,n,r,i,e[o+6],9,-1069501632),i=md5_gg(i,s,n,r,e[o+11],14,643717713),r=md5_gg(r,i,s,n,e[o+0],20,-373897302),n=md5_gg(n,r,i,s,e[o+5],5,-701558691),s=md5_gg(s,n,r,i,e[o+10],9,38016083),i=md5_gg(i,s,n,r,e[o+15],14,-660478335),r=md5_gg(r,i,s,n,e[o+4],20,-405537848),n=md5_gg(n,r,i,s,e[o+9],5,568446438),s=md5_gg(s,n,r,i,e[o+14],9,-1019803690),i=md5_gg(i,s,n,r,e[o+3],14,-187363961),r=md5_gg(r,i,s,n,e[o+8],20,1163531501),n=md5_gg(n,r,i,s,e[o+13],5,-1444681467),s=md5_gg(s,n,r,i,e[o+2],9,-51403784),i=md5_gg(i,s,n,r,e[o+7],14,1735328473),r=md5_gg(r,i,s,n,e[o+12],20,-1926607734),n=md5_hh(n,r,i,s,e[o+5],4,-378558),s=md5_hh(s,n,r,i,e[o+8],11,-2022574463),i=md5_hh(i,s,n,r,e[o+11],16,1839030562),r=md5_hh(r,i,s,n,e[o+14],23,-35309556),n=md5_hh(n,r,i,s,e[o+1],4,-1530992060),s=md5_hh(s,n,r,i,e[o+4],11,1272893353),i=md5_hh(i,s,n,r,e[o+7],16,-155497632),r=md5_hh(r,i,s,n,e[o+10],23,-1094730640),n=md5_hh(n,r,i,s,e[o+13],4,681279174),s=md5_hh(s,n,r,i,e[o+0],11,-358537222),i=md5_hh(i,s,n,r,e[o+3],16,-722521979),r=md5_hh(r,i,s,n,e[o+6],23,76029189),n=md5_hh(n,r,i,s,e[o+9],4,-640364487),s=md5_hh(s,n,r,i,e[o+12],11,-421815835),i=md5_hh(i,s,n,r,e[o+15],16,530742520),r=md5_hh(r,i,s,n,e[o+2],23,-995338651),n=md5_ii(n,r,i,s,e[o+0],6,-198630844),s=md5_ii(s,n,r,i,e[o+7],10,1126891415),i=md5_ii(i,s,n,r,e[o+14],15,-1416354905),r=md5_ii(r,i,s,n,e[o+5],21,-57434055),n=md5_ii(n,r,i,s,e[o+12],6,1700485571),s=md5_ii(s,n,r,i,e[o+3],10,-1894986606),i=md5_ii(i,s,n,r,e[o+10],15,-1051523),r=md5_ii(r,i,s,n,e[o+1],21,-2054922799),n=md5_ii(n,r,i,s,e[o+8],6,1873313359),s=md5_ii(s,n,r,i,e[o+15],10,-30611744),i=md5_ii(i,s,n,r,e[o+6],15,-1560198380),r=md5_ii(r,i,s,n,e[o+13],21,1309151649),n=md5_ii(n,r,i,s,e[o+4],6,-145523070),s=md5_ii(s,n,r,i,e[o+11],10,-1120210379),i=md5_ii(i,s,n,r,e[o+2],15,718787259),r=md5_ii(r,i,s,n,e[o+9],21,-343485551),n=safe_add(n,u),r=safe_add(r,a),i=safe_add(i,f),s=safe_add(s,l)}return Array(n,r,i,s)}function md5_cmn(e,t,n,r,i,s){return safe_add(bit_rol(safe_add(safe_add(t,e),safe_add(r,s)),i),n)}function md5_ff(e,t,n,r,i,s,o){return md5_cmn(t&n|~t&r,e,t,i,s,o)}function md5_gg(e,t,n,r,i,s,o){return md5_cmn(t&r|n&~r,e,t,i,s,o)}function md5_hh(e,t,n,r,i,s,o){return md5_cmn(t^n^r,e,t,i,s,o)}function md5_ii(e,t,n,r,i,s,o){return md5_cmn(n^(t|~r),e,t,i,s,o)}function safe_add(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function bit_rol(e,t){return e<<t|e>>>32-t}var hexcase=0,b64pad="",UserPhoto={init:function(e){switch(e.service.toLowerCase()){case"facebook":return new FacebookUserPhoto(e);case"gravatar":return new GravatarUserPhoto(e)}},initFromUrl:function(e){var t;return/facebook\.com/.test(e)?(t=new FacebookUserPhoto,t.setUrl(e)):/gravatar\.com/.test(e)&&(t=new GravatarUserPhoto,t.setUrl(e)),t}},FacebookUserPhoto=function(e){var t=this,n;return e=e||{},e.serviceId&&(n="https://graph.facebook.com/"+e.serviceId+"/picture"),t.url=function(){return n},t.large=function(){return t.url()+"?type=large"},t.setUrl=function(e){n=e},t},GravatarUserPhoto=function(e){var t=this,n;return e=e||{},t.url=function(){return n},t.large=function(){return t.url()+"?s=200"},t.setUrl=function(e){n=e},e.serviceId&&t.setUrl("http://www.gravatar.com/avatar/"+hex_md5(e.serviceId)),t};(function(){function e(t,n,r){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped);if(t.isEqual&&E.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&E.isFunction(n.isEqual))return n.isEqual(t);var i=a.call(t);if(i!=a.call(n))return!1;switch(i){case"[object String]":return t==""+n;case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=typeof t||"object"!=typeof n)return!1;for(var s=r.length;s--;)if(r[s]==t)return!0;r.push(t);var s=0,o=!0;if("[object Array]"==i){if(s=t.length,o=s==n.length)for(;s--&&(o=s in t==s in n&&e(t[s],n[s],r)););}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var u in t)if(E.has(t,u)&&(s++,!(o=E.has(n,u)&&e(t[u],n[u],r))))break;if(o){for(u in n)if(E.has(n,u)&&!(s--))break;o=!s}}return r.pop(),o}var t=this,n=t._,r={},i=Array.prototype,s=Object.prototype,o=i.slice,u=i.unshift,a=s.toString,f=s.hasOwnProperty,l=i.forEach,c=i.map,h=i.reduce,p=i.reduceRight,d=i.filter,v=i.every,m=i.some,g=i.indexOf,y=i.lastIndexOf,s=Array.isArray,b=Object.keys,w=Function.prototype.bind,E=function(e){return new _(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=E),exports._=E):t._=E,E.VERSION="1.3.3";var S=E.each=E.forEach=function(e,t,n){if(e!=null)if(l&&e.forEach===l)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(n,e[i],i,e)===r)break}else for(i in e)if(E.has(e,i)&&t.call(n,e[i],i,e)===r)break};E.map=E.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(S(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},E.reduce=E.foldl=E.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=E.bind(t,r)),i?e.reduce(t,n):e.reduce(t);S(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},E.reduceRight=E.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=E.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=E.toArray(e).reverse();return r&&!i&&(t=E.bind(t,r)),i?E.reduce(s,t,n,r):E.reduce(s,t)},E.find=E.detect=function(e,t,n){var r;return x(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},E.filter=E.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(S(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},E.reject=function(e,t,n){var r=[];return e==null?r:(S(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},E.every=E.all=function(e,t,n){var i=!0;return e==null?i:v&&e.every===v?e.every(t,n):(S(e,function(e,s,o){if(!(i=i&&t.call(n,e,s,o)))return r}),!!i)};var x=E.some=E.any=function(e,t,n){t||(t=E.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,n):(S(e,function(e,s,o){if(i||(i=t.call(n,e,s,o)))return r}),!!i)};E.include=E.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:n=x(e,function(e){return e===t})},E.invoke=function(e,t){var n=o.call(arguments,2);return E.map(e,function(e){return(E.isFunction(t)?t||e:e[t]).apply(e,n)})},E.pluck=function(e,t){return E.map(e,function(e){return e[t]})},E.max=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&E.isEmpty(e))return-Infinity;var r={computed:-Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i>=r.computed&&(r={value:e,computed:i})}),r.value},E.min=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&E.isEmpty(e))return Infinity;var r={computed:Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i<r.computed&&(r={value:e,computed:i})}),r.value},E.shuffle=function(e){var t=[],n;return S(e,function(e,r){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},E.sortBy=function(e,t,n){var r=E.isFunction(t)?t:function(e){return e[t]};return E.pluck(E.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},E.groupBy=function(e,t){var n={},r=E.isFunction(t)?t:function(e){return e[t]};return S(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},E.sortedIndex=function(e,t,n){n||(n=E.identity);for(var r=0,i=e.length;r<i;){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},E.toArray=function(e){return e?E.isArray(e)||E.isArguments(e)?o.call(e):e.toArray&&E.isFunction(e.toArray)?e.toArray():E.values(e):[]},E.size=function(e){return E.isArray(e)?e.length:E.keys(e).length},E.first=E.head=E.take=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},E.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},E.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},E.rest=E.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},E.compact=function(e){return E.filter(e,function(e){return!!e})},E.flatten=function(e,t){return E.reduce(e,function(e,n){return E.isArray(n)?e.concat(t?n:E.flatten(n)):(e[e.length]=n,e)},[])},E.without=function(e){return E.difference(e,o.call(arguments,1))},E.uniq=E.unique=function(e,t,n){var n=n?E.map(e,n):e,r=[];return e.length<3&&(t=!0),E.reduce(n,function(n,i,s){if(t?E.last(n)!==i||!n.length:!E.include(n,i))n.push(i),r.push(e[s]);return n},[]),r},E.union=function(){return E.uniq(E.flatten(arguments,!0))},E.intersection=E.intersect=function(e){var t=o.call(arguments,1);return E.filter(E.uniq(e),function(e){return E.every(t,function(t){return E.indexOf(t,e)>=0})})},E.difference=function(e){var t=E.flatten(o.call(arguments,1),!0);return E.filter(e,function(e){return!E.include(t,e)})},E.zip=function(){for(var e=o.call(arguments),t=E.max(E.pluck(e,"length")),n=Array(t),r=0;r<t;r++)n[r]=E.pluck(e,""+r);return n},E.indexOf=function(e,t,n){if(e==null)return-1;var r;if(n)return n=E.sortedIndex(e,t),e[n]===t?n:-1;if(g&&e.indexOf===g)return e.indexOf(t);n=0;for(r=e.length;n<r;n++)if(n in e&&e[n]===t)return n;return-1},E.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},E.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0);for(var n=arguments[2]||1,r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);i<r;)s[i++]=e,e+=n;return s};var T=function(){};E.bind=function(e,t){var n,r;if(e.bind===w&&w)return w.apply(e,o.call(arguments,1));if(!E.isFunction(e))throw new TypeError;return r=o.call(arguments,2),n=function(){if(this instanceof n){T.prototype=e.prototype;var i=new T,s=e.apply(i,r.concat(o.call(arguments)));return Object(s)===s?s:i}return e.apply(t,r.concat(o.call(arguments)))}},E.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=E.functions(e)),S(t,function(t){e[t]=E.bind(e[t],e)}),e},E.memoize=function(e,t){var n={};return t||(t=E.identity),function(){var r=t.apply(this,arguments);return E.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},E.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},E.defer=function(e){return E.delay.apply(E,[e,1].concat(o.call(arguments,1)))},E.throttle=function(e,t){var n,r,i,s,o,u,a=E.debounce(function(){o=s=!1},t);return function(){return n=this,r=arguments,i||(i=setTimeout(function(){i=null,o&&e.apply(n,r),a()},t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},E.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments;n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,s)},t)}},E.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},E.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},E.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},E.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},E.keys=b||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[],n;for(n in e)E.has(e,n)&&(t[t.length]=n);return t},E.values=function(e){return E.map(e,E.identity)},E.functions=E.methods=function(e){var t=[],n;for(n in e)E.isFunction(e[n])&&t.push(n);return t.sort()},E.extend=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},E.pick=function(e){var t={};return S(E.flatten(o.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},E.defaults=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},E.clone=function(e){return E.isObject(e)?E.isArray(e)?e.slice():E.extend({},e):e},E.tap=function(e,t){return t(e),e},E.isEqual=function(t,n){return e(t,n,[])},E.isEmpty=function(e){if(e==null)return!0;if(E.isArray(e)||E.isString(e))return e.length===0;for(var t in e)if(E.has(e,t))return!1;return!0},E.isElement=function(e){return!!e&&e.nodeType==1},E.isArray=s||function(e){return a.call(e)=="[object Array]"},E.isObject=function(e){return e===Object(e)},E.isArguments=function(e){return a.call(e)=="[object Arguments]"},E.isArguments(arguments)||(E.isArguments=function(e){return!!e&&!!E.has(e,"callee")}),E.isFunction=function(e){return a.call(e)=="[object Function]"},E.isString=function(e){return a.call(e)=="[object String]"},E.isNumber=function(e){return a.call(e)=="[object Number]"},E.isFinite=function(e){return E.isNumber(e)&&isFinite(e)},E.isNaN=function(e){return e!==e},E.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},E.isDate=function(e){return a.call(e)=="[object Date]"},E.isRegExp=function(e){return a.call(e)=="[object RegExp]"},E.isNull=function(e){return e===null},E.isUndefined=function(e){return e===void 0},E.has=function(e,t){return f.call(e,t)},E.noConflict=function(){return t._=n,this},E.identity=function(e){return e},E.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},E.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},E.result=function(e,t){if(e==null)return null;var n=e[t];return E.isFunction(n)?n.call(e):n},E.mixin=function(e){S(E.functions(e),function(t){P(t,E[t]=e[t])})};var N=0;E.uniqueId=function(e){var t=N++;return e?e+t:t},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/.^/,k={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"},L;for(L in k)k[k[L]]=L;var A=/\\|'|\r|\n|\t|\u2028|\u2029/g,O=/\\(\\|'|r|n|t|u2028|u2029)/g,M=function(e){return e.replace(O,function(e,t){return k[t]})};E.template=function(e,t,n){n=E.defaults(n||{},E.templateSettings),e="__p+='"+e.replace(A,function(e){return"\\"+k[e]}).replace(n.escape||C,function(e,t){return"'+\n_.escape("+M(t)+")+\n'"}).replace(n.interpolate||C,function(e,t){return"'+\n("+M(t)+")+\n'"}).replace(n.evaluate||C,function(e,t){return"';\n"+M(t)+"\n;__p+='"})+"';\n",n.variable||(e="with(obj||{}){\n"+e+"}\n");var e="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+e+"return __p;\n",r=new Function(n.variable||"obj","_",e);return t?r(t,E):(t=function(e){return r.call(this,e,E)},t.source="function("+(n.variable||"obj")+"){\n"+e+"}",t)},E.chain=function(e){return E(e).chain()};var _=function(e){this._wrapped=e};E.prototype=_.prototype;var D=function(e,t){return t?E(e).chain():e},P=function(e,t){_.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),D(t.apply(E,e),this._chain)}};E.mixin(E),S("pop,push,reverse,shift,sort,splice,unshift".split(","),function(e){var t=i[e];_.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],D(n,this._chain)}}),S(["concat","join","slice"],function(e){var t=i[e];_.prototype[e]=function(){return D(t.apply(this._wrapped,arguments),this._chain)}}),_.prototype.chain=function(){return this._chain=!0,this},_.prototype.value=function(){return this._wrapped}}).call(this),function(){var e=this,t=e.Backbone,n=Array.prototype.slice,r=Array.prototype.splice,i;typeof exports!="undefined"?i=exports:i=e.Backbone={},i.VERSION="0.9.2";var s=e._;!s&&typeof require!="undefined"&&(s=require("underscore"));var o=e.jQuery||e.Zepto||e.ender;i.setDomLibrary=function(e){o=e},i.noConflict=function(){return e.Backbone=t,this},i.emulateHTTP=!1,i.emulateJSON=!1;var u=/\s+/,a=i.Events={on:function(e,t,n){var r,i,s,o,a;if(!t)return this;e=e.split(u),r=this._callbacks||(this._callbacks={});while(i=e.shift())a=r[i],s=a?a.tail:{},s.next=o={},s.context=n,s.callback=t,r[i]={tail:o,next:a?a.next:s};return this},off:function(e,t,n){var r,i,o,a,f,l;if(!(i=this._callbacks))return;if(!(e||t||n))return delete this._callbacks,this;e=e?e.split(u):s.keys(i);while(r=e.shift()){o=i[r],delete i[r];if(!o||!t&&!n)continue;a=o.tail;while((o=o.next)!==a)f=o.callback,l=o.context,(t&&f!==t||n&&l!==n)&&this.on(r,f,l)}return this},trigger:function(e){var t,r,i,s,o,a,f;if(!(i=this._callbacks))return this;a=i.all,e=e.split(u),f=n.call(arguments,1);while(t=e.shift()){if(r=i[t]){s=r.tail;while((r=r.next)!==s)r.callback.apply(r.context||this,f)}if(r=a){s=r.tail,o=[t].concat(f);while((r=r.next)!==s)r.callback.apply(r.context||this,o)}}return this}};a.bind=a.on,a.unbind=a.off;var f=i.Model=function(e,t){var n;e||(e={}),t&&t.parse&&(e=this.parse(e));if(n=C(this,"defaults"))e=s.extend({},n,e);t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=s.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=s.clone(this.attributes),this.initialize.apply(this,arguments)};s.extend(f.prototype,a,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return s.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var n=this.get(e);return this._escapedAttributes[e]=s.escape(n==null?"":""+n)},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,o;s.isObject(e)||e==null?(r=e,n=t):(r={},r[e]=t),n||(n={});if(!r)return this;r instanceof f&&(r=r.attributes);if(n.unset)for(i in r)r[i]=void 0;if(!this._validate(r,n))return!1;this.idAttribute in r&&(this.id=r[this.idAttribute]);var u=n.changes={},a=this.attributes,l=this._escapedAttributes,c=this._previousAttributes||{};for(i in r){o=r[i];if(!s.isEqual(a[i],o)||n.unset&&s.has(a,i))delete l[i],(n.silent?this._silent:u)[i]=!0;n.unset?delete a[i]:a[i]=o,!s.isEqual(c[i],o)||s.has(a,i)!=s.has(c,i)?(this.changed[i]=o,n.silent||(this._pending[i]=!0)):(delete this.changed[i],delete this._pending[i])}return n.silent||this.change(n),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(s.clone(this.attributes),e)},fetch:function(e){e=e?s.clone(e):{};var t=this,n=e.success;return e.success=function(r,i,s){if(!t.set(t.parse(r,s),e))return!1;n&&n(t,r)},e.error=i.wrapError(e.error,t,e),(this.sync||i.sync).call(this,"read",this,e)},save:function(e,t,n){var r,o;s.isObject(e)||e==null?(r=e,n=t):(r={},r[e]=t),n=n?s.clone(n):{};if(n.wait){if(!this._validate(r,n))return!1;o=s.clone(this.attributes)}var u=s.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?u:n))return!1;var a=this,f=n.success;n.success=function(e,t,i){var o=a.parse(e,i);n.wait&&(delete n.wait,o=s.extend(r||{},o));if(!a.set(o,n))return!1;f?f(a,e):a.trigger("sync",a,e,n)},n.error=i.wrapError(n.error,a,n);var l=this.isNew()?"create":"update",c=(this.sync||i.sync).call(this,l,this,n);return n.wait&&this.set(o,u),c},destroy:function(e){e=e?s.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(this.isNew())return r(),!1;e.success=function(i){e.wait&&r(),n?n(t,i):t.trigger("sync",t,i,e)},e.error=i.wrapError(e.error,t,e);var o=(this.sync||i.sync).call(this,"delete",this,e);return e.wait||r(),o},url:function(){var e=C(this,"urlRoot")||C(this.collection,"url")||k();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var n in this._silent)this._pending[n]=!0;var r=s.extend({},e.changes,this._silent);this._silent={};for(var n in r)this.trigger("change:"+n,this,this.get(n),e);if(t)return this;while(!s.isEmpty(this._pending)){this._pending={},this.trigger("change",this,e);for(var n in this.changed){if(this._pending[n]||this._silent[n])continue;delete this.changed[n]}this._previousAttributes=s.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return arguments.length?s.has(this.changed,e):!s.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?s.clone(this.changed):!1;var t,n=!1,r=this._previousAttributes;for(var i in e){if(s.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return s.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=s.extend({},this.attributes,e);var n=this.validate(e,t);return n?(t&&t.error?t.error(this,n,t):this.trigger("error",this,n,t),!1):!0}});var l=i.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};s.extend(l.prototype,a,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var n,i,o,u,a,f,l={},c={},h=[];t||(t={}),e=s.isArray(e)?e.slice():[e];for(n=0,o=e.length;n<o;n++){if(!(u=e[n]=this._prepareModel(e[n],t)))throw new Error("Can't add an invalid model to a collection");a=u.cid,f=u.id;if(l[a]||this._byCid[a]||f!=null&&(c[f]||this._byId[f])){h.push(n);continue}l[a]=c[f]=u}n=h.length;while(n--)e.splice(h[n],1);for(n=0,o=e.length;n<o;n++)(u=e[n]).on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id!=null&&(this._byId[u.id]=u);this.length+=o,i=t.at!=null?t.at:this.models.length,r.apply(this.models,[i,0].concat(e)),this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(n=0,o=this.models.length;n<o;n++){if(!l[(u=this.models[n]).cid])continue;t.index=n,u.trigger("add",u,this,t)}return this},remove:function(e,t){var n,r,i,o;t||(t={}),e=s.isArray(e)?e.slice():[e];for(n=0,r=e.length;n<r;n++){o=this.getByCid(e[n])||this.get(e[n]);if(!o)continue;delete this._byId[o.id],delete this._byCid[o.cid],i=this.indexOf(o),this.models.splice(i,1),this.length--,t.silent||(t.index=i,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,s.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return s.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=s.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return s.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return this._reset(),this.add(e,s.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?s.clone(e):{},e.parse===undefined&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r,i,s){t[e.add?"add":"reset"](t.parse(r,s),e),n&&n(t,r)},e.error=i.wrapError(e.error,t,e),(this.sync||i.sync).call(this,"read",this,e)},create:function(e,t){var n=this;t=t?s.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;return t.success=function(i,s,o){t.wait&&n.add(i,t),r?r(i,s):i.trigger("sync",e,s,t)},e.save(null,t),e},parse:function(e,t){return e},chain:function(){return s(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){t||(t={});if(e instanceof f)e.collection||(e.collection=this);else{var n=e;t.collection=this,e=new this.model(n,t),e._validate(e.attributes,t)||(e=!1)}return e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments)}});var c=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];s.each(c,function(e){l.prototype[e]=function(){return s[e].apply(s,[this.models].concat(s.toArray(arguments)))}});var h=i.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},p=/:\w+/g,d=/\*\w+/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;s.extend(h.prototype,a,{initialize:function(){},route:function(e,t,n){return i.history||(i.history=new m),s.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),i.history.route(e,s.bind(function(r){var s=this._extractParameters(e,r);n&&n.apply(this,s),this.trigger.apply(this,["route:"+t].concat(s)),i.history.trigger("route",this,t,s)},this)),this},navigate:function(e,t){i.history.navigate(e,t)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(v,"\\$&").replace(p,"([^/]+)").replace(d,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var m=i.History=function(){this.handlers=[],s.bindAll(this,"checkUrl")},g=/^[#\/]/,y=/msie [\w.]+/;m.started=!1,s.extend(m.prototype,a,{interval:50,getHash:function(e){var t=e?e.location:window.location,n=t.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n)}else e=this.getHash();return e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(g,"")},start:function(e){if(m.started)throw new Error("Backbone.history has already been started");m.started=!0,this.options=s.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),n=document.documentMode,r=y.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);r&&(this.iframe=o('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=window.location,u=i.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&i.hash&&(this.fragment=this.getHash().replace(g,""),window.history.replaceState({},document.title,i.protocol+"//"+i.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){o(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t==this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=s.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!m.started)return!1;if(!
t||t===!0)t={trigger:t};var n=(e||"").replace(g,"");if(this.fragment==n)return;this._hasPushState?(n.indexOf(this.options.root)!=0&&(n=this.options.root+n),this.fragment=n,window.history[t.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,t.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){n?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var b=i.View=function(e){this.cid=s.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName"];s.extend(b.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){var r=document.createElement(e);return t&&o(r).attr(t),n&&o(r).html(n),r},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o?e:o(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=C(this,"events")))return;this.undelegateEvents();for(var t in e){var n=e[t];s.isFunction(n)||(n=this[e[t]]);if(!n)throw new Error('Method "'+e[t]+'" does not exist');var r=t.match(w),i=r[1],o=r[2];n=s.bind(n,this),i+=".delegateEvents"+this.cid,o===""?this.$el.bind(i,n):this.$el.delegate(o,i,n)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=s.extend({},this.options,e));for(var t=0,n=E.length;t<n;t++){var r=E[t];e[r]&&(this[r]=e[r])}this.options=e},_ensureElement:function(){if(!this.el){var e=C(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}else this.setElement(this.el,!1)}});var S=function(e,t){var n=N(this,e,t);return n.extend=this.extend,n};f.extend=l.extend=h.extend=b.extend=S;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};i.sync=function(e,t,n){var r=x[e];n||(n={});var u={type:r,dataType:"json"};return n.url||(u.url=C(t,"url")||k()),!n.data&&t&&(e=="create"||e=="update")&&(u.contentType="application/json",u.data=JSON.stringify(t.toJSON())),i.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),i.emulateHTTP&&(r==="PUT"||r==="DELETE")&&(i.emulateJSON&&(u.data._method=r),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r)}),u.type!=="GET"&&!i.emulateJSON&&(u.processData=!1),o.ajax(s.extend(u,n))},i.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var T=function(){},N=function(e,t,n){var r;return t&&t.hasOwnProperty("constructor")?r=t.constructor:r=function(){e.apply(this,arguments)},s.extend(r,e),T.prototype=e.prototype,r.prototype=new T,t&&s.extend(r.prototype,t),n&&s.extend(r,n),r.prototype.constructor=r,r.__super__=e.prototype,r},C=function(e,t){return!e||!e[t]?null:s.isFunction(e[t])?e[t]():e[t]},k=function(){throw new Error('A "url" property or function must be specified')}}.call(this),window.TA.Class=function(){var e={extend:function(e){var t=function(e){this.options=e};return t.prototype=e,function(e){var n=new t(e);return n.initialize&&n.initialize(e),n}}};return e}(),window.TA.Object={serialize:function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}},function(){var e,t=function(e,t){if("function"==typeof document.addEventListener||r.isIE8()){var i=!1;try{i=e instanceof Element}catch(o){i=!!e&&1===i.nodeType}i||"string"==typeof e||(t=e);var u=this,a=u.classes,f=u.settings=r.merge(u.defaults,{attachTo:e},t||{}),i=u.container=r.make("div",{"class":a.container}),l=u.calendars=[],c=_().day(f.weekStart),h,p=[],d,v,m;d=[];var g;v=0,h=f.months,r.isIE8()&&r.addClassName(i,"ie8");for(v=7;v--;)p.push(c.format("ddd").substr(0,f.columnHeaderLength)),c.add("days",1);s(u);if("object"==typeof f.subscribe)for(v in f.subscribe)f.subscribe.hasOwnProperty(v)&&u.subscribe(v,f.subscribe[v]);u._sel=[],f.selected&&u.setSelected(f.selected,!1),h=f.viewStartDate?_(f.viewStartDate,f.format):0<u._sel.length?_(u._sel[0]):_(),u.viewStartDate=h.date(1),(h={past:f.months-1,"today-past":f.months-1,any:2<f.months?Math.floor(f.months/2):0,"today-future":0,future:0}[this.settings.direction])&&_().month()==_(u.viewStartDate).month()&&(u.viewStartDate=_(u.viewStartDate).subtract({M:h}).date(1));if("function"==typeof f.blackout)u.blackout=f.blackout;else if(f.blackout){var y=n(f.blackout,f.parseSplitDelimiter);u.blackout=function(e){e=_(e).yearDay();if(1>e||!u._sel||1>u._sel.length)return!1;for(var t=y.length;t--;)if(y[t].yearDay()===e)return!0;return!1}}else u.blackout=function(){return!1};u.direction=u.directions[f.direction]?u.directions[f.direction]:u.directions.any;for(h=Math.max(f.months,1);h--;){d=r.make("div",{"class":a.calendar},i),d.setAttribute("data-cal-index",h),1<f.months&&(h==Math.max(f.months-1,1)?r.addClassName(d,a.monthFirst):0===h?r.addClassName(d,a.monthLast):r.addClassName(d,a.monthMiddle)),v=r.make("div",{"class":a.title},d),f.useYearNav||r.addClassName(v,a.disableYearNav),r.make("a",{"class":a.previousYear},v),r.make("a",{"class":a.previousMonth},v),r.make("a",{"class":a.nextYear},v),r.make("a",{"class":a.nextMonth},v),c=r.make("span",{"class":a.caption},v),m=r.make("div",{"class":a.header},d),v=0;do g=r.make("span",{},m),g.innerHTML=p[v];while(7>++v);m=r.make("div",{"class":a.days},d),v=0;for(d=[];42>v++;)d.push(r.make("span",{},m));l.push({caption:c,days:d}),h&&r.make("div",{"class":a.monthSeparator},i)}u.draw(),r.addEvent(i,"mousedown",function(e,t){var n;if(r.hasClassName(t,a.nextMonth))!u.disableNext&&!1!==u.publish("view-changed",u,["next-month"])&&(u.viewStartDate.add("months",1),u.draw());else if(r.hasClassName(t,a.previousMonth))!u.disablePreviousMonth&&!1!==u.publish("view-changed",u,["previous-month"])&&(u.viewStartDate.subtract("months",1),u.draw());else if(r.hasClassName(t,a.nextYear))!u.disableNext&&!1!==u.publish("view-changed",u,["next-year"])&&(u.viewStartDate.add("years",1),u.draw());else if(r.hasClassName(t,a.previousYear))!u.disablePreviousMonth&&!1!==u.publish("view-changed",u,["previous-year"])&&(u.viewStartDate.subtract("years",1),u.draw());else if(r.hasClassName(t.parentNode,a.days)&&r.hasClassName(t,a.dayActive)&&(n=t.getAttribute("data-date")))if(n=_(n,f.dayAttributeFormat).hours(12),!1!==u.publish("date-clicked",u,[n]))switch(f.mode){case"multiple":u.addSelected(n)||u.removeSelected(n);break;case"range":u.addSelected(n);break;default:u.addSelected(n)}return!1}),(f.attachTo=r.$(f.attachTo))&&f.attachTo.appendChild(i)}};t.prototype={defaults:{attachTo:null,months:1,weekStart:0,direction:"any",directionScrolling:!0,viewStartDate:null,blackout:null,selected:null,mode:"single",dayOutOfMonthClickable:!1,format:null,subscribe:null,columnHeaderLength:2,titleFormat:"MMMM, YYYY",dayNumberFormat:"D",dayAttributeFormat:"YYYY-MM-DD",parseSplitDelimiter:/,\s*|\s+-\s+/,rangeDelimiter:" - ",multipleDelimiter:", ",useYearNav:!0,dateClassMap:{}},classes:{container:"kalendae",calendar:"k-calendar",monthFirst:"k-first-month",monthMiddle:"k-middle-month",monthLast:"k-last-month",title:"k-title",previousMonth:"k-btn-previous-month",nextMonth:"k-btn-next-month",previousYear:"k-btn-previous-year",nextYear:"k-btn-next-year",caption:"k-caption",header:"k-header",days:"k-days",dayOutOfMonth:"k-out-of-month",dayInMonth:"k-in-month",dayActive:"k-active",daySelected:"k-selected",dayInRange:"k-range",dayToday:"k-today",monthSeparator:"k-separator",disablePreviousMonth:"k-disable-previous-month-btn",disableNextMonth:"k-disable-next-month-btn",disablePreviousYear:"k-disable-previous-year-btn",disableNextYear:"k-disable-next-year-btn",disableYearNav:"k-disable-year-nav"},disablePreviousMonth:!1,disableNextMonth:!1,disablePreviousYear:!1,disableNextYear:!1,directions:{past:function(t){return _(t).yearDay()>=e.yearDay()},"today-past":function(t){return _(t).yearDay()>e.yearDay()},any:function(){return!1},"today-future":function(t){return _(t).yearDay()<e.yearDay()},future:function(t){return _(t).yearDay()<=e.yearDay()}},getSelectedAsDates:function(){for(var e=[],t=0,n=this._sel.length;t<n;t++)e.push(this._sel[t].toDate());return e},getSelectedAsText:function(e){for(var t=[],n=0,r=this._sel.length;n<r;n++)t.push(this._sel[n].format(e||this.settings.format||"YYYY-MM-DD"));return t},getSelectedRaw:function(){for(var e=[],t=0,n=this._sel.length;t<n;t++)e.push(_(this._sel[t]));return e},getSelected:function(e){e=this.getSelectedAsText(e);switch(this.settings.mode){case"range":return e.splice(2),e.join(this.settings.rangeDelimiter);case"multiple":return e.join(this.settings.multipleDelimiter);default:return e[0]}},isSelected:function(e){e=_(e).yearDay();if(1>e||!this._sel||1>this._sel.length)return!1;switch(this.settings.mode){case"range":var t=this._sel[0]?this._sel[0].yearDay():0,n=this._sel[1]?this._sel[1].yearDay():0;return t===e||n===e?1:!t||!n?0:e>t&&e<n||t<n&&e<t&&e>n?-1:!1;case"multiple":for(t=this._sel.length;t--;)if(this._sel[t].yearDay()===e)return!0;return!1;default:return this._sel[0]&&this._sel[0].yearDay()===e}},setSelected:function(e,t){this._sel=n(e,this.settings.parseSplitDelimiter,this.settings.format),this._sel.sort(function(e,t){return e.yearDay()-t.yearDay()}),!1!==t&&this.draw()},addSelected:function(e,t){e=_(e).hours(12),this.settings.dayOutOfMonthClickable&&"range"!==this.settings.mode&&this.makeSelectedDateVisible(e);switch(this.settings.mode){case"multiple":if(this.isSelected(e))return!1;this._sel.push(e);break;case"range":1!==this._sel.length?this._sel=[e]:e.yearDay()>this._sel[0].yearDay()?this._sel[1]=e:this._sel=[e,this._sel[0]];break;default:this._sel=[e]}return this._sel.sort(function(e,t){return e.yearDay()-t.yearDay()}),this.publish("change",this),!1!==t&&this.draw(),!0},makeSelectedDateVisible:function(e){outOfViewMonth=_(e).date("1").diff(this.viewStartDate,"months"),0>outOfViewMonth?this.viewStartDate.subtract("months",1):0<outOfViewMonth&&outOfViewMonth>=this.settings.months&&this.viewStartDate.add("months",1)},removeSelected:function(e,t){for(var e=_(e).yearDay(),n=this._sel.length;n--;)if(this._sel[n].yearDay()===e)return this._sel.splice(n,1),this.publish("change",this),!1!==t&&this.draw(),!0;return!1},draw:function(){var t=_(this.viewStartDate).hours(12),n,i=this.classes,s,o,u,a=0,f,l=0,c,h=this.settings;f=this.calendars.length;do{n=_(t).date(1),n.day(n.day()<this.settings.weekStart?this.settings.weekStart-7:this.settings.weekStart),s=this.calendars[a],s.caption.innerHTML=t.format(this.settings.titleFormat),l=0;do o=s.days[l],u=[],(c=this.isSelected(n))&&u.push({"-1":i.dayInRange,1:i.daySelected,"true":i.daySelected}[c]),n.month()!=t.month()?u.push(i.dayOutOfMonth):u.push(i.dayInMonth),(!this.blackout(n)&&!(this.direction(n)||n.month()!=t.month()&&!1===h.dayOutOfMonthClickable)||0<c)&&u.push(i.dayActive),n.yearDay()===e.yearDay()&&u.push(i.dayToday),c=n.format(this.settings.dayAttributeFormat),h.dateClassMap[c]&&u.push(h.dateClassMap[c]),o.innerHTML=n.format(h.dayNumberFormat),o.className=u.join(" "),o.setAttribute("data-date",c),n.add("days",1);while(42>++l);t.add("months",1)}while(++a<f);if(h.directionScrolling){n=-_().diff(t,"months");if("today-past"===h.direction||"past"===h.direction)0>n?(this.disableNextMonth=!1,r.removeClassName(this.container,i.disableNextMonth)):(this.disableNextMonth=!0,r.addClassName(this.container,i.disableNextMonth));else if("today-future"===h.direction||"future"===h.direction)n>=h.months?(this.disablePreviousMonth=!1,r.removeClassName(this.container,i.disablePreviousMonth)):(this.disablePreviousMonth=!0,r.addClassName(this.container,i.disablePreviousMonth));if("today-past"===h.direction||"past"===h.direction)0>=t.add({y:1}).diff(_(),"months")?(this.disableNextYear=!1,r.removeClassName(this.container,i.disableNextYear)):(this.disableNextYear=!0,r.addClassName(this.container,i.disableNextYear));else if("today-future"===h.direction||"future"===h.direction)0<=t.subtract({y:1}).diff(_(),"months")-(h.months-1)?(this.disablePreviousYear=!1,r.removeClassName(this.container,i.disablePreviousYear)):(this.disablePreviousYear=!0,r.addClassName(this.container,i.disablePreviousYear))}}};var n=function(e,t,n){var s=[];"string"==typeof e?e=e.split(t):r.isArray(e)||(e=[e]),t=e.length,i=0;do e[i]&&s.push(_(e[i],n).hours(12));while(++i<t);return s};window.Kalendae=t;var r=t.util={isIE8:function(){return!(!/msie 8./i.test(navigator.appVersion)||/opera/i.test(navigator.userAgent)||!window.ActiveXObject||!XDomainRequest||window.msPerformance)},$:function(e){return"string"==typeof e?document.getElementById(e):e},$$:function(e){return document.querySelectorAll(e)},make:function(e,t,n){var r,e=document.createElement(e);if(t)for(r in t)t.hasOwnProperty(r)&&e.setAttribute(r,t[r]);return n&&n.appendChild(e),e},isVisible:function(e){return 0<e.offsetWidth||0<e.offsetHeight},getStyle:function(e,t){var n;return e.currentStyle?n=e.currentStyle[t]:window.getComputedStyle&&(n=window.getComputedStyle(e,null)[t]),n},domReady:function(e){/in/.test(document.readyState)?setTimeout(function(){r.domReady(e)},9):e()},addEvent:function(e,t,n){var r=function(t){var t=t||window.event,r=n.apply(e,[t,t.target||t.srcElement]);return!1===r&&(t.preventDefault?t.preventDefault():(t.returnValue=!1,t.cancelBubble=!0)),r};return e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener(t,r,!1),r},removeEvent:function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},hasClassName:function(e,t){if(!(e=r.$(e)))return!1;var n=e.className;return 0<n.length&&(n==t||RegExp("(^|\\s)"+t+"(\\s|$)").test(n))},addClassName:function(e,t){(e=r.$(e))&&!r.hasClassName(e,t)&&(e.className+=(e.className?" ":"")+t)},removeClassName:function(e,t){if(e=r.$(e))e.className=r.trimString(e.className.replace(RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))},isFixed:function(e){do if("fixed"===r.getStyle(e,"position"))return!0;while(e=e.offsetParent);return!1},scrollContainer:function(e){do{var t=r.getStyle(e,"overflow");if("auto"===t||"scroll"===t)return e}while((e=e.parentNode)&&e!=window.document.body);return null},getPosition:function(e,t){var n=e.offsetLeft,r=e.offsetTop,i={};if(!t)for(;e=e.offsetParent;)n+=e.offsetLeft,r+=e.offsetTop;return i[0]=i.left=n,i[1]=i.top=r,i},getHeight:function(e){return e.offsetHeight||e.scrollHeight},getWidth:function(e){return e.offsetWidth||e.scrollWidth},trimString:function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},merge:function(){for(var e=!0===arguments[0],t={},n=e?1:0;n<arguments.length;n++){var r=t,i=arguments[n];if("object"==typeof i){var s=void 0;for(s in i)i.hasOwnProperty(s)&&(e&&"object"==typeof r[s]&&"object"==typeof i[s]?_update(r[s],i[s]):r[s]=i[s])}}return t},isArray:function(e){return!(!e||!e.length||0===e.length||"object"!=typeof e||!e.constructor||e.nodeType||e.item)}};"function"==typeof document.addEventListener&&t.util.domReady(function(){for(var e=r.$$(".auto-kal"),n=e.length,i,s;n--;)i=e[n],s=i.getAttribute("data-kal"),s=null==s||""==s?{}:(new Function("return {"+s+"};"))(),"INPUT"===i.tagName?new t.Input(i,s):new t(r.merge(s,{attachTo:i}))}),t.Input=function(e,n){if("function"==typeof document.addEventListener||r.isIE8()){var i=this.input=r.$(e),s;if(!i||"INPUT"!==i.tagName)throw"First argument for Kalendae.Input must be an <input> element or a valid element id.";var o=this,u=o.classes;opts=o.settings=r.merge(o.defaults,n),opts.attachTo=window.document.body,opts.selected?s=!0:opts.selected=i.value,t.call(o,opts);if(opts.closeButton){var a=r.make("a",{"class":u.closeButton},o.container);r.addEvent(a,"click",function(){i.blur()})}s&&(i.value=o.getSelected()),s=o.container;var f=!1;s.style.display="none",r.addClassName(s,u.positioned),r.addEvent(s,"mousedown",function(){f=!0}),r.addEvent(window.document,"mousedown",function(){f=!1}),r.addEvent(i,"focus",function(){o.setSelected(this.value),o.show()}),r.addEvent(i,"blur",function(){f?(f=!1,i.focus()):o.hide()}),r.addEvent(i,"keyup",function(){o.setSelected(this.value)}),(u=r.scrollContainer(i))&&r.addEvent(u,"scroll",function(){i.blur()}),o.subscribe("change",function(){i.value=o.getSelected()})}},t.Input.prototype=r.merge(t.prototype,{defaults:r.merge(t.prototype.defaults,{format:"MM/DD/YYYY",side:"bottom",closeButton:!0,offsetLeft:0,offsetTop:0}),classes:r.merge(t.prototype.classes,{positioned:"k-floating",closeButton:"k-btn-close"}),show:function(){var e=this.container,t=e.style,n=this.input,i=r.getPosition(n),s=r.scrollContainer(n),s=s?s.scrollTop:0;t.display="";switch(opts.side){case"left":t.left=i.left-r.getWidth(e)+this.settings.offsetLeft+"px",t.top=i.top+this.settings.offsetTop-s+"px";break;case"right":t.left=i.left+r.getWidth(n)+"px",t.top=i.top+this.settings.offsetTop-s+"px";break;case"top":t.left=i.left+this.settings.offsetLeft+"px",t.top=i.top-r.getHeight(e)+this.settings.offsetTop-s+"px";break;default:t.left=i.left+this.settings.offsetLeft+"px",t.top=i.top+r.getHeight(n)+this.settings.offsetTop-s+"px"}t.position=r.isFixed(n)?"fixed":"absolute",this.publish("show",this)},hide:function(){this.container.style.display="none",this.publish("hide",this)}});var s=function(e){e||(e=this);var t=e.c_||{};e.publish=function(e,n,r){for(var i=(e=t[e])?e.length:0,s;i--;)if(s=e[i].apply(n,r||[]),"boolean"==typeof s)return s},e.subscribe=function(e,n,r){return t[e]||(t[e]=[]),r?t[e].push(n):t[e].unshift(n),[e,n]},e.unsubscribe=function(e){for(var n=t[e[0]],e=e[1],r=n?n.length:0;r--;)n[r]===e&&n.splice(r,1)}},o=Date,u=function(e,t){this._d=e,this._isUTC=!!t},a=function(e,t){for(var n=e+"";n.length<t;)n="0"+n;return n},f=function(e,t,n,r){var i="string"==typeof t,s=i?{}:t;return i&&r&&(s[t]=+r),t=(s.ms||s.milliseconds||0)+1e3*(s.s||s.seconds||0)+6e4*(s.m||s.minutes||0)+36e5*(s.h||s.hours||0),r=(s.d||s.days||0)+7*(s.w||s.weeks||0),s=(s.M||s.months||0)+12*(s.y||s.years||0),t&&e.setTime(+e+t*n),r&&e.setDate(e.getDate()+r*n),s&&(t=e.getDate(),e.setDate(1),e.setMonth(e.getMonth()+s*n),e.setDate(Math.min((new o(e.getFullYear(),e.getMonth()+1,0)).getDate(),t))),e},l=function(e){return"[object Array]"===Object.prototype.toString.call(e)},c=function(e){return new o(e[0],e[1]||0,e[2]||1,e[3]||0,e[4]||0,e[5]||0,e[6]||0)},h=function(e,t){function n(t){var g;switch(t){case"M":return r+1;case"Mo":return r+1+d(r+1);case"MM":return a(r+1,2);case"MMM":return m.monthsShort[r];case"MMMM":return m.months[r];case"D":return i;case"Do":return i+d(i);case"DD":return a(i,2);case"DDD":return t=new o(s,r,i),g=new o(s,0,1),~~((t-g)/864e5+1.5);case"DDDo":return t=n("DDD"),t+d(t);case"DDDD":return a(n("DDD"),3);case"d":return u;case"do":return u+d(u);case"ddd":return m.weekdaysShort[u];case"dddd":return m.weekdays[u];case"w":return t=new o(s,r,i-u+5),g=new o(t.getFullYear(),0,4),~~((t-g)/864e5/7+1.5);case"wo":return t=n("w"),t+d(t);case"ww":return a(n("w"),2);case"YY":return a(s%100,2);case"YYYY":return s;case"a":return 11<f?v.pm:v.am;case"A":return 11<f?v.PM:v.AM;case"H":return f;case"HH":return a(f,2);case"h":return f%12||12;case"hh":return a(f%12||12,2);case"m":return l;case"mm":return a(l,2);case"s":return c;case"ss":return a(c,2);case"zz":case"z":return(e._d.toString().match(N)||[""])[0].replace(T,"");case"Z":return(0>p?"-":"+")+a(~~(Math.abs(p)/60),2)+":"+a(~~(Math.abs(p)%60),2);case"ZZ":return(0>p?"-":"+")+a(~~(10*Math.abs(p)/6),4);case"L":case"LL":case"LLL":case"LLLL":case"LT":return h(e,m.longDateFormat[t]);default:return t.replace(/(^\[)|(\\)|\]$/g,"")}}var r=e.month(),i=e.date(),s=e.year(),u=e.day(),f=e.hours(),l=e.minutes(),c=e.seconds(),p=-e.zone(),d=m.ordinal,v=m.meridiem;return t.replace(x,n)},p=function(e,t){var n=[0,0,1,0,0,0,0],r=0,i=0,s=!1,u=e.match(k),a=t.match(C),f=Math.min(u.length,a.length),l,h;for(l=0;l<f;l++){var p=u[l],d=void 0;switch(a[l]){case"M":case"MM":n[1]=~~p-1;break;case"MMM":case"MMMM":for(d=0;12>d;d++)if(m.monthsParse[d].test(p)){n[1]=d;break}break;case"D":case"DD":case"DDD":case"DDDD":n[2]=~~p;break;case"YY":p=~~p,n[0]=p+(70<p?1900:2e3);break;case"YYYY":n[0]=~~Math.abs(p);break;case"a":case"A":h="pm"===p.toLowerCase();break;case"H":case"HH":case"h":case"hh":n[3]=~~p;break;case"m":case"mm":n[4]=~~p;break;case"s":case"ss":n[5]=~~p;break;case"Z":case"ZZ":s=!0,(d=(p||"").match(O))&&d[1]&&(r=~~d[1]),d&&d[2]&&(i=~~d[2]),d&&"+"===d[0]&&(r=-r,i=-i)}}return h&&12>n[3]&&(n[3]+=12),!1===h&&12===n[3]&&(n[3]=0),n[3]+=r,n[4]+=i,s?new o(o.UTC.apply({},n)):c(n)},d=function(e,t,n){var r=m.relativeTime[e];return"function"==typeof r?r(t||1,!!n,e):r.replace(/%d/i,t||1)},v=function(e,t){m.fn[e]=function(e){var n=this._isUTC?"UTC":"";return"undefined"!=typeof e?(this._d["set"+n+t](e),this):this._d["get"+n+t]()}},m,g=Math.round,y={},b="undefined"!=typeof module,w="months monthsShort monthsParse weekdays weekdaysShort longDateFormat calendar relativeTime ordinal meridiem".split(" "),E,S=/^\/?Date\((\-?\d+)/i,x=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|dddd?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|zz?|ZZ?|LT|LL?L?L?)/g,T=/[^A-Z]/g,N=/\([A-Za-z ]+\)|:[0-9]{2} [A-Z]{3} /g,C=/(\\)?(MM?M?M?|dd?d?d|DD?D?D?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|ZZ?|T)/g,k=/(\\)?([0-9]+|([a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+|([\+\-]\d\d:?\d\d))/gi,L=/\d{4}.\d\d.\d\d(T(\d\d(.\d\d(.\d\d)?)?)?([\+\-]\d\d:?\d\d)?)?/,A=[["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],O=/([\+\-]|\d\d)/gi,M="Month Date Hours Minutes Seconds Milliseconds".split(" ");m=function(e,t){if(null===e||""===e)return null;var n;if(e&&e._d instanceof o)n=new o(+e._d);else if(t)if(l(t)){var r=e.match(k),i=99,s,a,f;for(s=0;s<t.length;s++){a=p(e,t[s]),f=r;for(var d=h(new u(a),t[s]).match(k),v=Math.min(f.length,d.length),m=Math.abs(f.length-d.length),g=0,y=void 0,y=0;y<v;y++)~~f[y]!==~~d[y]&&g++;f=g+m,f<i&&(i=f,n=a)}}else n=p(e,t);else if(n=S.exec(e),void 0===e)n=new o;else if(n)n=new o(+n[1]);else if(e instanceof o)n=e;else if(l(e))n=c(e);else if("string"==typeof e)if(n="YYYY-MM-DDT",L.exec(e)){for(r=0;3>r;r++)if(A[r][1].exec(e)){n+=A[r][0];break}n=p(e,n+"Z")}else n=new o(e);else n=new o(e);return new u(n)},m.utc=function(e,t){return l(e)?new u(new o(o.UTC.apply({},e)),!0):t&&e?m(e+" 0",t+" Z").utc():m(e).utc()},m.humanizeDuration=function(e,t,n){var e=+e,r=m.relativeTime;switch(t){case"seconds":e*=1e3;break;case"minutes":e*=6e4;break;case"hours":e*=36e5;break;case"days":e*=864e5;break;case"weeks":e*=6048e5;break;case"months":e*=2592e6;break;case"years":e*=31536e6;break;default:n=!!t}var t=!n,i=g(Math.abs(e)/1e3),s=g(i/60),o=g(s/60),u=g(o/24),a=g(u/365),i=45>i&&["s",i]||1===s&&["m"]||45>s&&["mm",s]||1===o&&["h"]||22>o&&["hh",o]||1===u&&["d"]||25>=u&&["dd",u]||45>=u&&["M"]||345>u&&["MM",g(u/30)]||1===a&&["y"]||["yy",a];return i[2]=t,t=d.apply({},i),n?(0>=e?r.past:r.future).replace(/%s/i,t):t},m.version="1.5.0",m.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",m.lang=function(e,t){var n,r;r=[];if(t){for(n=0;12>n;n++)r[n]=RegExp("^"+t.months[n]+"|^"+t.monthsShort[n].replace(".",""),"i");t.monthsParse=t.monthsParse||r,y[e]=t}if(y[e])for(n=0;n<w.length;n++)r=w[n],m[r]=y[e][r]||m[r];else b&&(n=require("./lang/"+e),m.lang(e,n))},m.lang("en",{months:"January February March April May June July August September October November December".split(" "),monthsShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),weekdaysShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:{AM:"AM",am:"am",PM:"PM",pm:"pm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10;return 1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th"}}),m.isMoment=function(e){return e instanceof u},m.fn=u.prototype={clone:function(){return m(this)},valueOf:function(){return+this._d},"native":function(){return this._d},toString:function(){return this._d.toString()},toDate:function(){return this._d},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(e){return h(this,e?e:m.defaultFormat)},add:function(e,t){return this._d=f(this._d,e,1,t),this},subtract:function(e,t){return this._d=f(this._d,e,-1,t),this},diff:function(e,t,n){var e=m(e),r=6e4*(this.zone()-e.zone()),r=this._d-e._d-r,i=this.year()-e.year(),s=this.month()-e.month(),e=this.date()-e.date(),t="months"===t?12*i+s+e/30:"years"===t?i+s/12:"seconds"===t?r/1e3:"minutes"===t?r/6e4:"hours"===t?r/36e5:"days"===t?r/864e5:"weeks"===t?r/6048e5:r;return n?t:g(t)},from:function(e,t){return m.humanizeDuration(this.diff(e),!t)},fromNow:function(e){return this.from(m(),e)},calendar:function(){var e=this.diff(m().sod(),"days",!0),t=m.calendar,n=t.sameElse,e=-6>e?n:-1>e?t.lastWeek:0>e?t.lastDay:1>e?t.sameDay:2>e?t.nextDay:7>e?t.nextWeek:n;return this.format("function"==typeof e?e.apply(this):e)},isLeapYear:function(){var e=this.year();return 0===e%4&&0!==e%100||0===e%400},isDST:function(){return this.zone()<m([this.year()]).zone()||this.zone()<m([this.year(),5]).zone()},day:function(e){var t=this._d.getDay();return"undefined"==typeof e?t:this.add({d:e-t})},sod:function(){return this.clone().hours(0).minutes(0).seconds(0).milliseconds(0)},eod:function(){return this.sod().add({d:1,ms:-1})},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return this.clone().month(this.month()+1).date(0).date()}};for(E=0;E<M.length;E++)v(M[E].toLowerCase(),M[E]);v("year","FullYear");var _=t.moment=m;_.fn.stripTime=function(){return this._d=new Date(864e5*Math.floor(this._d.valueOf()/864e5)),this},_.fn.yearDay=function(e){var t=Math.floor(this._d/864e5);return"undefined"==typeof e?t:this.add({d:e-t})},e=_().stripTime(),"undefined"!=typeof jQuery&&"function"==typeof document.addEventListener&&(jQuery.fn.kalendae=function(e){return this.each(function(n,r){"INPUT"===r.tagName?$(r).data("kalendae",new t.Input(r,e)):$(r).data("kalendae",new t($.extend({},{attachTo:r},e)))}),this})}();var Kayak=Backbone.View.extend(function(){function n(n,r){r=TA.Object.extend(e,r),n.setAttribute("src",t+"?"+TA.Object.serialize(r))}function r(){var e=document.createElement("div");return e.className="kayak-button-overlay",e}var e={ai:"kayaksample",doubleEncoded:"on",size:"300x250"},t="http://www.kayak.com/widget/300x250";return{initialize:function(e){this.options.defaults=e.defaults||{}},populate:function(e){n(this.options.iframe,TA.Object.extend(this.options.defaults,e))},render:function(){n(this.options.iframe,{})}}}());(function(e,t){typeof exports=="object"&&exports?module.exports=t:typeof define=="function"&&define.amd?define(t):e.Mustache=t})(this,function(){function f(e,t){return u.call(e,t)}function l(e){return!f(r,e)}function h(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function d(e){return String(e).replace(/[&<>"'\/]/g,function(e){return p[e]})}function v(e){this.string=e,this.tail=e,this.pos=0}function m(e,t){this.view=e,this.parent=t,this._cache={}}function g(){this.clearCache()}function y(t,n,r,i){var s="",o,u,a;for(var f=0,l=t.length;f<l;++f){o=t[f],u=o[1];switch(o[0]){case"#":a=r.lookup(u);if(typeof a=="object")if(c(a))for(var h=0,p=a.length;h<p;++h)s+=y(o[4],n,r.push(a[h]),i);else a&&(s+=y(o[4],n,r.push(a),i));else if(typeof a=="function"){var d=i==null?null:i.slice(o[3],o[5]);a=a.call(r.view,d,function(e){return n.render(e,r)}),a!=null&&(s+=a)}else a&&(s+=y(o[4],n,r,i));break;case"^":a=r.lookup(u);if(!a||c(a)&&a.length===0)s+=y(o[4],n,r,i);break;case">":a=n.getPartial(u),typeof a=="function"&&(s+=a(r));break;case"&":a=r.lookup(u),a!=null&&(s+=a);break;case"name":a=r.lookup(u),a!=null&&(s+=e.escape(a));break;case"text":s+=u}}return s}function b(e){var t=[],n=t,r=[],i;for(var s=0,o=e.length;s<o;++s){i=e[s];switch(i[0]){case"#":case"^":r.push(i),n.push(i),n=i[4]=[];break;case"/":var u=r.pop();u[5]=i[2],n=r.length>0?r[r.length-1][4]:t;break;default:n.push(i)}}return t}function w(e){var t=[],n,r;for(var i=0,s=e.length;i<s;++i)n=e[i],n&&(n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(r=n,t.push(n)));return t}function E(e){return[new RegExp(h(e[0])+"\\s*"),new RegExp("\\s*"+h(e[1]))]}var e={};e.name="mustache.js",e.version="0.7.2",e.tags=["{{","}}"],e.Scanner=v,e.Context=m,e.Writer=g;var t=/\s*/,n=/\s+/,r=/\S/,i=/\s*=/,s=/\s*\}/,o=/#|\^|\/|>|\{|&|=|!/,u=RegExp.prototype.test,a=Object.prototype.toString,c=Array.isArray||function(e){return a.call(e)==="[object Array]"},p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};e.escape=d,v.prototype.eos=function(){return this.tail===""},v.prototype.scan=function(e){var t=this.tail.match(e);return t&&t.index===0?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},v.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},m.make=function(e){return e instanceof m?e:new m(e)},m.prototype.push=function(e){return new m(e,this)},m.prototype.lookup=function(e){var t=this._cache[e];if(!t){if(e==".")t=this.view;else{var n=this;while(n){if(e.indexOf(".")>0){t=n.view;var r=e.split("."),i=0;while(t&&i<r.length)t=t[r[i++]]}else t=n.view[e];if(t!=null)break;n=n.parent}}this._cache[e]=t}return typeof t=="function"&&(t=t.call(this.view)),t},g.prototype.clearCache=function(){this._cache={},this._partialCache={}},g.prototype.compile=function(t,n){var r=this._cache[t];if(!r){var i=e.parse(t,n);r=this._cache[t]=this.compileTokens(i,t)}return r},g.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},g.prototype.getPartial=function(e){return!(e in this._partialCache)&&this._loadPartial&&this.compilePartial(e,this._loadPartial(e)),this._partialCache[e]},g.prototype.compileTokens=function(e,t){var n=this;return function(r,i){if(i)if(typeof i=="function")n._loadPartial=i;else for(var s in i)n.compilePartial(s,i[s]);return y(e,n,m.make(r),t)}},g.prototype.render=function(e,t,n){return this.compile(e)(t,n)},e.parse=function(r,u){function y(){if(m&&!g)while(d.length)delete p[d.pop()];else d=[];m=!1,g=!1}r=r||"",u=u||e.tags,typeof u=="string"&&(u=u.split(n));if(u.length!==2)throw new Error("Invalid tags: "+u.join(", "));var a=E(u),f=new v(r),c=[],p=[],d=[],m=!1,g=!1,S,x,T,N,C;while(!f.eos()){S=f.pos,T=f.scanUntil(a[0]);if(T)for(var k=0,L=T.length;k<L;++k)N=T.charAt(k),l(N)?d.push(p.length):g=!0,p.push(["text",N,S,S+1]),S+=1,N=="\n"&&y();if(!f.scan(a[0]))break;m=!0,x=f.scan(o)||"name",f.scan(t),x==="="?(T=f.scanUntil(i),f.scan(i),f.scanUntil(a[1])):x==="{"?(T=f.scanUntil(new RegExp("\\s*"+h("}"+u[1]))),f.scan(s),f.scanUntil(a[1]),x="&"):T=f.scanUntil(a[1]);if(!f.scan(a[1]))throw new Error("Unclosed tag at "+f.pos);C=[x,T,S,f.pos],p.push(C);if(x==="#"||x==="^")c.push(C);else if(x==="/"){if(c.length===0)throw new Error('Unopened section "'+T+'" at '+S);var A=c.pop();if(A[1]!==T)throw new Error('Unclosed section "'+A[1]+'" at '+S)}else if(x==="name"||x==="{"||x==="&")g=!0;else if(x==="="){u=T.split(n);if(u.length!==2)throw new Error("Invalid tags at "+S+": "+u.join(", "));a=E(u)}}var A=c.pop();if(A)throw new Error('Unclosed section "'+A[1]+'" at '+f.pos);return p=w(p),b(p)};var S=new g;return e.clearCache=function(){return S.clearCache()},e.compile=function(e,t){return S.compile(e,t)},e.compilePartial=function(e,t,n){return S.compilePartial(e,t,n)},e.compileTokens=function(e,t){return S.compileTokens(e,t)},e.render=function(e,t,n){return S.render(e,t,n)},e.to_html=function(t,n,r,i){var s=e.render(t,n,r);if(typeof i!="function")return s;i(s)},e}());var Template=Backbone.Model.extend({load:function(e){var t=this,n=this.get("params")||{};$.ajax({url:"/template/"+t.id,data:n,success:function(t){var n=document.createElement("div");n.innerHTML=t,e.success&&e.success(n)}})}}),Country=Backbone.Model.extend({}),FlickrImage=Backbone.Model.extend({url:function(e){return e=e?"_"+e:"","http://farm"+this.get("farm")+".static.flickr.com/"+
this.get("server")+"/"+this.get("id")+"_"+this.get("secret")+e+".jpg"}}),Location=Backbone.Model.extend({url:function(){var e=this.trip().url();return this.isNew()?e+="/locations/create":e+="/locations/"+this.get("slug"),e},latLng:function(){return new google.maps.LatLng(this.get("latitude")||40.7142,this.get("longitude")||-74.0064)},jsonPrefix:!1,toJSON:function(){return this.jsonPrefix?{location:this.attributes}:this.attributes},smartTitle:function(){return this.geoString({includeTitle:!0})},geoString:function(e){e=e||{};var t=this;if(t.get("title")&&e.includeTitle!==!1)return t.get("title");if(t.get("city")&&t.get("state"))return t.get("city")+", "+t.get("state");if(t.get("city")&&t.country.get("name"))return t.get("city")+", "+t.country.get("name");if(t.get("state")&&t.country)return t.get("state")+", "+t.country.get("name");if(t.country)return t.country.get("name")},loadCountry:function(e){var t=this;e=e||{},TA.countries.fetch({success:function(n){if(t.get("country_id")){var r=n.get(t.get("country_id"));t.setCountry(r,{silent:!0})}e.success&&e.success(r)}})},setCountry:function(e,t){t=t||{},this.country=e,this.set({country_id:e.id},t)},setTrip:function(e){this._trip=e,this.set({trip_id:e.id})},user:function(){return this._user},setUser:function(e){this._user=e},trip:function(){return this._trip},hasLatLng:function(){return this.has("latitude")&&this.has("longitude")}});Location.createFromDataAttribute=function(e,t){t=t||"data-json";var n=JSON.parse(e.getAttribute(t));return new Location(n)};var Map=Backbone.Model.extend({attachFile:function(e){this.file=e},staticUrl:function(){if(this.isNew()&&this.file)return window.URL=window.URL||window.webkitURL,window.URL.createObjectURL(this.file);if(!this.isNew())return"http://s3.amazonaws.com/"+TA.config.s3.bucket+"/maps/"+this.get("id")+"/original/"+this.get("map_file_name")},readFile:function(e){if(!this.file)return;e=e||{};var t=this,n=new FileReader;n.onloadend=function(t){e.success&&e.success(t.target.result)},n.readAsText(this.file)},setUser:function(e){this._user=e},user:function(){return this._user},setTrip:function(e){this._trip=e,this.setUser(this._trip.user())},trip:function(){return this._trip},createWithXML:function(e){e=e||{};var t=this,n=new FormData;n.append("map[xml]",this.file);for(var r in t.attributes)n.append("map["+r+"]",t.attributes[r]);var i=new XMLHttpRequest;i.open("POST",t.url()),i.onload=function(n){if(i.status===200&&e.success){var r=JSON.parse(n.currentTarget.responseText);t.set(r),e.success(r)}},i.send(n)},drawGoogleMap:function(e,t){t=t||{};var n={center:new google.maps.LatLng(0,0),zoom:2,mapTypeId:google.maps.MapTypeId.HYBRID,scrollwheel:!1};for(var r in t)n[r]=t[r];this.setGoogleMap(new google.maps.Map(e,n));if(this.get("slug")){var i=new google.maps.KmlLayer(this.staticUrl());i.setMap(this.googleMap())}},setGoogleMap:function(e){this._googleMap=e},googleMap:function(){return this._googleMap},url:function(){return this.isNew()?this.trip().url()+"/maps/":this.trip().url()+"/maps/"+this.get("slug")}});Map.createFromDataAttribute=function(e,t){t=t||"data-json";var n=JSON.parse(e.getAttribute(t));return new Map(n)};var Photo=Backbone.Model.extend({initialize:function(e){if(!e)return;e.constructor===File?this.setRaw(e):e.constructor===Image&&this.setRaw(e)},__getBinaryFromElement:function(){var e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this.getRaw().width,e.height=this.getRaw().height,t.drawImage(this.getRaw(),0,0),!1},setUser:function(e){this._user=e},user:function(){return this._user},proportion:function(){return this.get("width")/this.get("height")},proportionHeight:function(e){return this.proportion()*e},src:function(){if(this.getRaw())return this.getRaw().src?this.getRaw().src:(window.URL=window.URL||window.webkitURL,window.URL.createObjectURL(this.getRaw()))},source:function(e){return e=e||"square","http://s3.amazonaws.com/"+TA.config.s3.bucket+"/statics/"+this.get("id")+"/"+e+"/"+this.get("static_file_name")},getRaw:function(e){return this._raw},setRaw:function(e){this._raw=e},url:function(){return this.user().url()+"/photos/"+this.get("slug")},setTrip:function(e){this.setUser(e.user()),this._trip=e},trip:function(){return this._trip},getBinary:function(e){e=e||{};if(this.getRaw().constructor===Image)e.success&&e.success(this.__getBinaryFromElement());else if(this.getRaw().constructor===File){var t=new FileReader;t.onload=function(t){e.success&&e.success(t.target.result)},t.readAsDataURL(this.getRaw())}}});Photo.createFromDataAttribute=function(e,t){t=t||"data-json";var n=JSON.parse(e.getAttribute(t));return new Photo(n)};var Post=Backbone.Model.extend({setTrip:function(e){this._trip=e,this.set({trip_id:e.id})},trip:function(){return this._trip},setUser:function(e){this._user=e},user:function(){return this._user}});Post.createFromDataAttribute=function(e,t){t=t||"data-json";var n=JSON.parse(e.getAttribute(t));return new Post(n)};var Status=Backbone.Model.extend({setUser:function(e){this.user=e},jsonPrefix:!0,toJSON:function(){return this.jsonPrefix?{status:this.attributes}:this.attributes},url:function(){return this.isNew()?this.user.url({includeFormat:!1})+"/statuses":this.user.url({includeFormat:!1})+"/statuses/"+this.id},setUser:function(e){this.user=e},setLocation:function(e){e.isNew()||this.set({location_id:e.id}),this.location=e},clearLocation:function(){this.location=null,this.set({location_id:null})}});Status.createFromDataAttribute=function(e,t){t=t||"data-json";var n=JSON.parse(e.getAttribute(t));return new Status(n)};var Trip=Backbone.Model.extend({initialize:function(){this._locations=new LocationsCollection},validate:function(e){if(!e.title)return{title:!0}},saveWithLocations:function(e){e=e||{},this.set({locations:this._locations.models});if(!this.isValid())return;this.save({},{success:function(t){e.success&&e.success(t)}})},setPhoto:function(e){this._photo=e,this.set({photo_id:e.id})},photo:function(){return this._photo},_photos:null,photos:function(e){var t=this;return e=e||{},this._photos===null&&(this._photos=new TripPhotosCollection({trip:this}),this._photos.fetch({success:function(n){n.each(function(e){e.setUser(t.user)}),e.success&&e.success(n)}})),this._photos},setLocations:function(e){var t=this;this._locations=e,this._locations.each(function(e){e.setTrip(t)})},editPhotosUrl:function(){return this.url()+"/photos"},editUrl:function(){return this.user().url({includeFormat:!1})+"/"+this.get("slug")},url:function(){return this.isNew()?this.user().url({includeFormat:!1})+"/trips":this.user().url({includeFormat:!1})+"/"+this.get("slug")},user:function(){return this._user},setUser:function(e){this.set({user_id:e}),this._user=e},locations:function(){return this._locations},mapsUrl:function(){return this.url()+"/maps"},setMaps:function(e){var t=this;e.each(function(e){e.setUser(t.user())}),this._maps=e},maps:function(){return this._maps}});Trip.createFromDataAttribute=function(e,t){t=t||"data-json";var n=JSON.parse(e.getAttribute(t));return new Trip(n)};var User=Backbone.Model.extend(function(){var e;return{initialize:function(e){this.set({name:e.name.replace("+"," ")})},jsonPrefix:!1,toJSON:function(){return this.jsonPrefix?{user:this.attributes}:this.attributes},fetchTrips:function(e){var t=this;e=e||{},$.ajax({url:this.url()+"/trips",data:{format:"json"},success:function(n){var r=new TripsCollection(n);t.setTrips(r),e.success&&e.success(r)}})},trips:function(){return _trips},setTrips:function(e){var t=this;_trips=e,_trips.each(function(e){e.setUser(t)})},latLng:function(){return new google.maps.LatLng(user.get("latitude"),user.get("longitude"))},staticPath:function(){return"http://"+TA.config.static.domain+"/"+TA.config.static.user_path+this.get("slug")+"/"},url:function(e){return"/"+this.get("slug")},isCurrentUser:function(){return TA.currentUser?this.get("id")==TA.currentUser.get("id"):!1},isAnonymous:function(){return this.get("token")=="anonymous"},flickrset_photos:function(e,t){t=t||{},$.ajax({url:this.url({includeFormat:!1})+"/flickr_photoset_photos/"+e,jsonpCallback:"jsonFlickrApi",success:function(e){t.success&&t.success(e)}})},_photos:null,photos:function(){var e;return this._photos||(e="/"+this.get("slug")+"/photos.json",this._photos=new PhotosCollection,this._photos.setUrl(e)),this._photos}}}());User.validateSlug=function(e,t){$.ajax({url:"/users/validate_slug",data:{slug:e},success:function(e){t.success&&t.success(e)}})},User.createFromDataAttribute=function(e,t){t=t||"data-json";var n=JSON.parse(e.getAttribute(t));return new User(n)};var CountryCollection=Backbone.Collection.extend({model:Country,url:"/countries?format=json",findByName:function(e){if(e=="")return;var t=this.where({name:e})[0];return t||(t=this.filter(function(t){return(new RegExp(e)).test(t.get("name"))})[0]),t}}),LocationsCollection=Backbone.Collection.extend({model:Location});LocationsCollection.createFromDataAttribute=function(e,t){t=t||"data-json";var n=JSON.parse(e.getAttribute(t));return new LocationsCollection(n)};var MapsCollection=Backbone.Collection.extend({model:Map});MapsCollection.createFromDataAttribute=function(e,t){t=t||"data-json";var n=JSON.parse(e.getAttribute(t));return new MapsCollection(n)};var PhotosCollection=Backbone.Collection.extend({model:Photo,_url:null,setUrl:function(e){this._url=e},url:function(){if(this._url!==null)return this._url;throw"PhotosCollection has no url. Please specify a url"}}),TripPhotosCollection=Backbone.Collection.extend({model:Photo,initialize:function(e){e.trip&&(this.trip=e.trip)},url:function(){return this.trip.url()+"/photos"}}),TripsCollection=Backbone.Collection.extend({model:Trip});TripsCollection.createFromDataAttribute=function(e,t){t=t||"data-json";var n=JSON.parse(e.getAttribute(t));return new TripsCollection(n)};var DropDown=Backbone.View.extend({initialize:function(){function e(t){return t==document.body?!1:e(t.parentNode)}return function(){var t=this,n=this.el;t.toggle=function(e){var n=/toggle/.test(t.options.control.className);n?t.hide(e):t.show(e)},t.hide=function(n){if(n&&n.target&&e(n.target))return;t.el.style.display="none",t.options.control.className=t.options.control.className.replace(" toggle",""),document.removeEventListener("keyup",t.toggle),document.removeEventListener("click",t.hide)}}}(),show:function(e){var t=this;t.el.style.display="block",t.options.control.className+=" toggle",t.options.control.addEventListener("click",t.hide),e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),document.addEventListener("click",t.hide),document.addEventListener("keyup",function(e){e.keyCode==27&&t.hide()})},render:function(){var e=this;return this.options.control&&this.options.control.addEventListener("click",e.toggle),e}}),DynamicTextarea=Backbone.View.extend({__bindEvents:function(){var e=this;this.el.addEventListener("keyup",function(t){e.resize()})},resize:function(){if(this.el.offsetHeight>=this.el.scrollHeight){var e=getComputedStyle(this.el),t=parseInt(e.paddingTop)+parseInt(e.paddingBottom);this.el.style.height=this.el.offsetHeight-t-10+"px",this.resize()}else this.el.offsetHeight<this.el.scrollHeight&&(this.el.style.height=this.el.scrollHeight-t-10+"px")},render:function(){var e=this;/autosize/.test(this.el.className)||(this.el.className+=" autosize"),this.el.addEventListener("keyup",function(){e.resize()}),e.resize(),this.__bindEvents()}}),Gallery=Backbone.View.extend({initialize:function(){var e=this;e.__keyup=function(t){switch(t.which){case 27:e.close();break;case 37:e.focusPrev();break;case 39:e.focusNext()}}},__distanceToLeft:function(){var e=this.el.offsetParent,t=this.el.offsetLeft;while(e!=document.body)t+=e.offsetLeft,e=e.offsetParent;return t},close:function(){var e=this;this.el.className=this.el.className.replace(" gallery",""),this.el.style.left="auto",this.el.style.marginLeft="auto",this.el.style.marginRight="auto",this.el.querySelector("ul").style.width="auto",[].forEach.call(e.options.photos,function(e,t){e.style.marginTop="0px",e.className=e.className.replace(" selected","")}),document.removeEventListener("keyup",e.__keyup),this.options.onClose&&this.options.onClose()},setSelected:function(e){if(e==this.options.selectedIndex)return;this.options.selectedIndex!=null&&(this.selectedPhoto().className=this.selectedPhoto().className.replace(" selected","")),this.options.selectedIndex=e,this.focusSelected()},focusNext:function(){var e=this.options.photos.length,t=this.options.selectedIndex+1;t<e&&this.setSelected(this.options.selectedIndex+1)},focusPrev:function(){var e=this.options.selectedIndex-1;e>=0&&this.setSelected(e)},selectedPhoto:function(){return this.options.photos.item(this.options.selectedIndex)},calculateWidth:function(){var e=this,t=0;return[].forEach.call(e.el.querySelectorAll("li"),function(e){var n=getComputedStyle(e);t+=e.offsetWidth+parseInt(n.marginLeft)+parseInt(n.marginRight)}),t},focusSelected:function(){var e=this.selectedPhoto(),t=this.options.photos.length,n=this.options.photos.item(t-1),r=e.offsetWidth,i=this.el.querySelector("ul");/selected/.test(e.className)||(e.className+=" selected"),i.style.width=this.calculateWidth()+"px",i.style.left=-1*(e.offsetLeft-(this.el.offsetWidth/2-e.offsetWidth/2))+"px",this.positionPhotos()},positionPhotos:function(){var e=this,t=e.el.querySelector("ul"),n=this.selectedPhoto();n.style.marginTop="0px";var r=parseInt(getComputedStyle(t).height);n.offsetHeight>r&&(t.style.height=n.offsetHeight+"px",r=parseInt(getComputedStyle(t).height)),[].forEach.call(e.options.photos,function(e,t){e.style.marginTop=r/2-e.offsetHeight/2+"px"})},render:function(){var e=this,t=this.__distanceToLeft();return this.el.className+=" gallery",this.el.style.marginLeft=-t+"px",this.el.style.marginRight=-t+"px",this.focusSelected(),[].forEach.call(this.options.photos,function(t,n){t.addEventListener("click",function(){e.setSelected(n)})}),document.addEventListener("keyup",e.__keyup),e}}),GoogleMap=Backbone.View.extend(function(){return{initialize:function(){var e=this;this.setMapOptions({center:new google.maps.LatLng(40.7142,-74.0064),zoom:4,mapTypeId:google.maps.MapTypeId.HYBRID,scrollwheel:!1}),this._locations.on("add",function(t){e.drawLocation(t)}),this._maps.on("add",function(t){e.drawMap(t)})},markers:[],setMapOptions:function(e){this._mapOptions=e},mapOptions:function(){return this._mapOptions},addLocations:function(e,t){t=t||{};var n=this;e.each(function(e){n._locations.add(e,t)})},setMaps:function(e){this._maps=e},setLocations:function(e){this._locations=e},_locations:new LocationsCollection,_maps:new MapsCollection,maps:function(){return this._maps},addMaps:function(e){var t=this;e.each(function(e){t._maps.add(e)})},drawMap:function(e){var t=this,n=0,r=new google.maps.KmlLayer(e.staticUrl(),{preserveViewport:!0,suppressInfoWindows:!0});google.maps.event.addListener(r,"click",function(){t.trigger("kml_click",{kml:r,map:e})}),google.maps.event.addListener(r,"defaultviewport_changed",function(){t.unionBounds(r.getDefaultViewport()),t.googleMap().fitBounds(t.bounds()),t.trigger("kml_loaded",{kml:r,map:e})}),r.setMap(this.googleMap()),e.on("destroy",function(){r.setMap(null)})},drawLocation:function(e){var t=this,n=(new LocationMarker({model:e,map:this.googleMap()})).render();t._locations.length>1?(t.unionBounds(new google.maps.LatLngBounds(e.latLng())),t.googleMap().fitBounds(t.bounds())):t._locations.length===1&&(t.googleMap().setCenter(t._locations.first().latLng()),t.googleMap().setZoom(10)),n.on("click",function(e){t.trigger("location_click",e)}),n.on("mouseover",function(e){t.trigger("location_mouseover",e)}),this.markers.push(n)},drawMaps:function(e){var t=this;return e=e||this._maps,e.each(function(e){t.drawMap(e)}),this},drawLocations:function(){var e=this;return e.markers=[],e._locations.each(function(t){e.drawLocation(t)}),this},mergeMapOptions:function(e){for(var t in e)this.mapOptions()[t]=e[t];return this},_googleMap:null,googleMap:function(){return this._googleMap},drawGoogleMap:function(){this._googleMap=new google.maps.Map(this.el,this.mapOptions())},_bounds:new google.maps.LatLngBounds,bounds:function(){return this._bounds},unionBounds:function(e){this._bounds=this.bounds().union(e)},render:function(){return this.drawGoogleMap(),this}}}()),Hero=Backbone.View.extend(function(){var e=function(e){/\sfocused/.test(e.className)||(e.className+=" focused")},t=function(e){e.className=e.className.replace(" focused","")},n=function(e){var t=document.createElement("nav"),n=[];return t.className="hero-nav",[].forEach.call(e.options.elements,function(i,s){var o=document.createElement("a");o.addEventListener("click",function(t){t.preventDefault(),e.showAtIndex(s),r(e)}),n.push(o),t.appendChild(o),e.on("show",function(e){e.in===i?o.className+=" active":/\sactive/.test(o.className)&&(o.className=o.className.replace(" active",""))})}),e.el.appendChild(t),t},r=function(e){e.trigger("userinteracted",{hero:e})},i=function(e,t){var n=setInterval(function(){e.showNext()},t);e.on("userinteracted",function(){clearTimeout(n)})};return{initialize:function(){this.current=null,this.options.elements=Array.prototype.slice.call(this.options.elements,0)},showAtIndex:function(e){return this.show(this.options.elements[e])},removeAtIndex:function(e){var t=this.options.elements[e];return this.remove(t),t},hideCurrent:function(){this.remove(this.current),this.current=null},hide:function(e){e&&t(e)},showPrevious:function(){var e=this.current,t=_.indexOf(this.options.elements,e),n=t-1<0?this.options.elements.length-1:t-1;this.showAtIndex(n)},showNext:function(){var e=this.current,t=_.indexOf(this.options.elements,e),n=t+1===this.options.elements.length?0:t+1;this.showAtIndex(n)},show:function(n){if(n){if(this.current){var r=this.current;t(r)}return this.current=n,e(n),this.trigger("show",{hero:this,out:r,"in":n}),{out:r,"in":n}}},render:function(){var e=this;return n(e),e.showAtIndex(0),i(e,5e3),e.el.addEventListener("mouseover",function(){r(e)}),e}}}()),InfiniteScroll=Backbone.View.extend({_page:1,_limit:18,_hitLimit:!1,initialize:function(){this.url=this.el.getAttribute("data-infinite"),this._page=this.options.page||1,this._limit=this.options.limit||18},_isFetching:!1,isFetching:function(e){if(typeof e!="boolean")return this._isFetching;this._isFetching=e},fetch:function(e){if(this._hitLimit||this.isFetching())return;this.isFetching(!0),e=e||{},$.ajax({url:this.url,data:{page:this._page,limit:this._limit},success:function(e){if(e===""){this._hitLimit=!0;return}this._page+=1;var t=document.createElement("div");t.innerHTML=e,this.el.appendChild(t),setTimeout(function(){this.isFetching(!1)}.bind(this),500)}.bind(this)})},listenToScroll:function(){var e={target:this.el,scrollEnd:function(e){this.isFetching()||this.fetch()}.bind(this)};this.options.scrollEl&&(e.scrollEl=this.options.scrollEl),new ScrollHandler(e)},render:function(){return this.listenToScroll(),this}}),Loading=Backbone.View.extend({doneLoading:function(){this.el.className=this.el.className.replace(" loading",""),this.loadingUI.parentNode&&this.loadingUI.parentNode.removeChild(this.loadingUI)},setLoadingView:function(e){this.loadingUI.innerHTML="",this.loadingUI.appendChild(e)},setMessage:function(e){var t=document.createElement("div");t.innerHTML=e,this.setLoadingView(t)},addLoadingClass:function(){this.el.className+=" loading"},loading:function(){this.addLoadingClass(),this.loadingUI.parentNode!==this.el&&this.el.appendChild(this.loadingUI),this.center()},center:function(){if(this.options.center===!1||this.loadingUI.children.length===0)return;var e=this.loadingUI.offsetHeight,t=this.loadingUI.children[0].offsetHeight;this.loadingUI.style.paddingTop=parseInt(e/2)-parseInt(t/2)+"px"},createLoadingUI:function(){this.loadingUI=document.createElement("div"),this.loadingUI.className="loading-ui"},render:function(){return this.createLoadingUI(),this}}),LocationInfowindow=Backbone.View.extend(function(){var e,t,n=!1;return{infoWindow:function(){return t=t||new google.maps.InfoWindow,t},bindElements:function(){var t=this,n=e.getElementsByClassName("location-title").item(0);n.addEventListener("keyup",function(e){t.model.set({title:e.currentTarget.value})})},load:function(e){e=e||{};var t=this;if(this._html&&e._html){e.success(this._html);return}var n=new Template({id:"location_infowindow",user:t.model.user(),params:{trip_id:t.model.id}});n.load({success:function(n){t._html=n,e.success&&e.success(n),t.trigger("html_load",{html:n})}})},show:function(){var e=this;this._isVisible=!0,e.load({success:function(t){e.infoWindow().setPosition(e.model.latLng()),e.infoWindow().setContent(t),e.infoWindow().open(e.options.map)}})},toggle:function(){this._isVisible?this.hide():this.show()},hide:function(){this.infoWindow().setMap(null),n=!1},render:function(){var e=this;return this.model.on("destroy",function(){e.infoWindow().setMap(null)}),this}}}()),LocationMarker=Backbone.View.extend({initialize:function(){var e=this.model,t=this;this.googleMarker=new google.maps.Marker,google.maps.event.addListener(this.googleMarker,"click",function(){t.options.click&&t.options.click(),t.trigger("click",{marker:t})}),google.maps.event.addListener(this.googleMarker,"mouseover",function(){t.trigger("mouseover",{marker:t})}),e.on("change",function(e,n){(n.changes.longitude||n.changes.latitude)&&t.render()})},removeMarker:function(){this.googleMarker.setMap(null)},drawMarker:function(){var e=this;this.model.hasLatLng()&&(markerHash={position:this.model.latLng(),map:this.options.map},this.googleMarker.setOptions(markerHash))},render:function(){var e=this;return this.drawMarker(),this.model.on("destroy",function(){e.googleMarker.setMap(null)}),this}}),ModalDialog=Backbone.View.extend({el:document.createElement("div"),initialize:function(){var e=this;this.view=null,this.options.parentElem=this.options.parentElem||document.body,this.viewFinder=document.createElement("section"),this.viewFinder.className="viewfinder",this.content=document.createElement("div"),this.content.className="modal-content",this.el.className="modal-dialog",this.titleElem=document.createElement("h1"),this.titleElem.className="modal-title",document.addEventListener("keyup",function(t){if(!e.isVisible())return;switch(t.keyCode){case 27:e.close()}})},loading:function(e){var t=new Loading({el:document.createElement("div")});t.render(),e&&t.setMessage(e),this.setView(t.el),t.addLoadingClass(),this.render(),t.loading()},setView:function(e){this.view=e,this.content.innerHTML="",this.content.appendChild(this.view)},close:function(){this.el.className=this.el.className.replace("visible",""),this.el.parentNode.removeChild(this.el),this.viewFinder.style.marginTop="auto",this.viewFinder.style.marginBottom="auto",this.viewFinder.style.width="auto",document.body.style.overflow="auto",this.title=null,this.options.onclose&&typeof this.options.onclose=="function"&&this.options.onclose()},append:function(){var e=this;e.options.parentElem.appendChild(this.el)},show:function(){this.append(),this.autocenter(),this.el.className+=" visible"},__verticalCenter:function(){var e=this.viewFinder.offsetHeight,t=window.innerHeight,n=(t-e)/2;this.viewFinder.style.marginTop=n+"px",this.viewFinder.style.marginBottom=n+"px"},autocenter:function(){this.viewFinder.style.float="left",this.viewFinder.style.width="auto";var e=getComputedStyle(this.viewFinder),t=this.viewFinder.offsetWidth-parseInt(e.paddingLeft)-parseInt(e.paddingRight);this.viewFinder.style.float="none",this.viewFinder.style.width=t+"px",this.viewFinder.style.marginLeft="auto",this.viewFinder.style.marginRight="auto",this.__verticalCenter()},isVisible:function(){return this.el.className.indexOf("visible")!=-1},setTitle:function(e){var t=this;this.title=e,this.el.getElementsByClassName("modal-title").length===0&&t.viewFinder.appendChild(this.titleElem),this.titleElem.innerHTML="",this.titleElem.appendChild(document.createTextNode(this.title))},appendCloseButton:function(){var e=this;if(e.el.getElementsByClassName("remove").length>0)return;var t=document.createElement("command");t.className="remove",t.addEventListener("click",function(){e.close()}),e.viewFinder.appendChild(t)},render:function(){var e=this;e.appendCloseButton(),e.el.appendChild(e.viewFinder),e.viewFinder.appendChild(this.content),e.show()}}),ScrollHandler=function(e){function n(){var e=t.target.offsetParent,n=t.target.offsetTop;while(e!=document.body&&e!==null)n+=e.offsetTop,e=e.offsetParent;return n}function r(){return(e.target.offsetHeight-i())*100}function i(){return n()-s()[1]}function s(){var e=window.scrollY;return[e,window.innerHeight+e]}function o(){return r()/e.target.offsetHeight}function u(){return t.target.offsetHeight}function a(){var t=n(),i=s();t>i[0]&&t<i[1]&&e.onScroll&&e.onScroll({percentVisible:o(),pixelsVisible:r()}),t+u()<i[1]+window.scrollY&&e.scrollEnd&&e.scrollEnd({percentVisible:o(),pixelsVisible:r()})}var t=this;t.target=e.target,t.scrollEl=e.scrollEl||window,t.scrollEl.addEventListener("scroll",function(e){a()}),a()},ShuffledElements=Backbone.View.extend({__numElementsLoaded:0,numElements:function(){return this.options.elements.length},positionHero:function(e){function i(){n.offsetHeight>t.el.offsetHeight&&(t.el.style.height=n.offsetHeight+"px");var r=t.el.offsetWidth/2-n.offsetWidth/2,i=t.el.offsetHeight/2-n.offsetHeight/2;n.style.left=r+"px",n.style.top=i+"px",t.positionDone(),e.success()}if(!this.options.hero){e.success();return}var t=this,n=this.options.hero,r=n.querySelector("img");n.className+=" shuffled",r.width!=0?i():r.onload=function(){i()},t.__bindHeroClick()},__bindHeroClick:function(){var e=this;this.options.heroClick&&e.options.hero.addEventListener("click",function(t){e.options.heroClick(t,{element:e.options.hero})})},__bindElementClick:function(e,t){var n=this;this.options.elementClick&&e.addEventListener("click",function(r){n.options.elementClick(r,{element:e,index:t})})},__getHeroBounds:function(){return{top:this.options.hero.offsetTop,left:this.options.hero.offsetLeft,right:this.options.hero.offsetLeft+this.options.hero.offsetWidth,bottom:this.options.hero.offsetTop+this.options.hero.offsetHeight,center:(this.options.hero.offsetLeft+(this.options.hero.offsetLeft+this.options.hero.offsetWidth))/2,verticalCenter:(this.options.hero.offsetTop+(this.options.hero.offsetTop+this.options.hero.offsetHeight))/2}},positionDone:function(){this.__numElementsLoaded+=1,this.__numElementsLoaded==this.numElements()&&(this.el.style.opacity=1)},positionElement:function(e,t){if(e==this.options.hero)return;var n=this,r=this.el,i=n.__getHeroBounds(),s=Math.cos(t),o=this.el.offsetWidth,u=Math.random()*(r.offsetHeight-e.offsetHeight),a=i.center+Math.cos(t)*(o/2.5)-e.offsetWidth/2,f=Math.sin(t)*10;e.style.left=a+"px",e.style.top=u+"px",e.style.webkitTransform="rotate("+f+"deg)",e.style.MozTransform="rotate("+f+"deg)",n.positionDone()},render:function(){var e=this;return this.el.className+=" shuffled-elements",e.positionHero({success:function(){[].forEach.call(e.options.elements,function(t,n){function r(){e.__bindElementClick(t,n),e.positionElement(t,n)}t.className+=" shuffled",e.options.elementShouldPosition?e.options.elementShouldPosition({element:t,index:n,callback:r}):r()})}}),e}}),Tabs=Backbone.View.extend({__bindNavClicks:function(){var e=this,t=0;for(t;t<e.options.tabLinks.length;t+=1){var n=this.options.tabLinks[t];n.addEventListener("click",function(t){t.preventDefault();var n=t.currentTarget.getAttribute("href").replace("#","");e.showTab(n)})}},hideTabs:function(){var e=0;for(e;e<this.options.tabViews.length;e+=1){var t=this.options.tabViews[e];t.className.indexOf(" visible")!==-1&&(t.className=t.className.replace(" visible",""))}this.el.className.indexOf(" open")!==-1&&(this.el.className=this.el.className.replace(" open",""))},showTab:function(e){this.hideTabs(),document.getElementById(e).className+=" visible",this.el.className+=" open"},__bindCloseButton:function(){if(!this.options.closeButton)return;var e=this;this.options.closeButton.addEventListener("click",function(){e.hideTabs()})},render:function(){var e=this;return e.__bindNavClicks(),e.__bindCloseButton(),e}}),TripMap=GoogleMap.extend({showLocationString:function(e){if(!this.options.geoElem)return;this.options.geoElem.innerHTML=e},render:function(){return GoogleMap.prototype.render.call(this),this.setLocations(this.model.locations()),this.setMaps(this.model.maps()),this}}),LocationInfoWindow=Backbone.View.extend({initialize:function(){this._infoWindow=new google.maps.InfoWindow},render:function(){var e=document.createElement("div"),t=document.createElement("a");t.setAttribute("href",this.model.url()),t.appendChild(document.createTextNode(this.model.get("title")));if(this.model.get("photo_url")){var n=document.createElement("img");n.setAttribute("src",this.model.get("photo_url")),e.appendChild(n)}return e.appendChild(t),this._infoWindow.setPosition(new google.maps.LatLng(this.model.get("latitude"),this.model.get("longitude"))),this._infoWindow.setContent(e),this},setLocation:function(e){return this.model=e,this},open:function(){this._infoWindow.open(this.options.map)}});window.addEventListener("DOMContentLoaded",function(){function f(e){var n=new google.maps.InfoWindow,i=new AdminTemplate({id:"map_form",user:r,params:{map_id:e.get("slug"),user_id:r.get("slug"),trip_id:t.get("slug")}});i.load({success:function(t){var r=new MapForm({el:t,model:e});n.setContent(t),n.setPosition(new google.maps.LatLng(e.get("start_lat"),e.get("start_lng"))),n.open(s.googleMap()),r.render(),e.on("destroy",function(){n.open(null)})}})}if(!/maps\-index\s/.test(document.body.className))return;var e=document.getElementById("map"),t=Trip.createFromDataAttribute(e,"data-trip"),n=MapsCollection.createFromDataAttribute(e),r=User.createFromDataAttribute(e,"data-user"),i=LocationsCollection.createFromDataAttribute(e,"data-locations");t.setUser(r),t.setMaps(n),t.setLocations(i);var s=new TripMap({el:e,model:t});s.render().drawMaps().drawLocations(),s.on("location_mouseover",function(e){var t=e.marker;t.model.setUser(t.model.trip().user());var n=new LocationInfowindow({model:t.model,map:s.googleMap()});n.show()}),s.on("location_click",function(e){window.location.href=e.marker.model.trip().url()});if(!/trips\-maps\-index\s/.test(document.body.className))return;var o=(new FileInput({el:e,input:document.getElementById("map-input-button"),dropTarget:document})).render(),u=(new Loading({el:document.body})).render(),a=document.getElementById("start-edit");o.setAllowedExtensions(["kml"]),a&&a.addEventListener("click",function(){s.startEdit(),s.on("marker_dragend",function(e){e.marker.model.save({})})}),s.on("kml_click",function(e){e.map.setTrip(t),f(e.map)}),o.on("file_added",function(){var e;return function(n){e&&e.setMap&&e.setMap(null);var i=new Map;i.setTrip(t),i.attachFile(n.file),u.setMessage("Parsing Map..."),u.loading(),i.createWithXML({success:function(e){var n=new AdminTemplate({id:"map_form",user:r,params:{map_id:i.get("slug"),user_id:r.get("slug"),trip_id:t.get("slug")}});s.drawMap(i),s.on("kml_loaded",function(e){e.map===i&&f(e.map)}),u.doneLoading()}})}}())}),window.addEventListener("DOMContentLoaded",function(){if(!/\sphotos\-index\s/.test(document.body.className))return;var e=new ModalDialog({}),t=User.createFromDataAttribute(document.getElementById("user")),n=Trip.createFromDataAttribute(document.getElementById("trip-photos")),r=new InfiniteScroll({el:document.getElementById("trip-photos")}),i={};r.render(),n.setUser(t),jQuery(document.getElementById("trip-photos")).on("click",".photo",function(r){var s=r.currentTarget,o=i[s.id];o||(o=i[s.id]=Photo.createFromDataAttribute(s),o.setUser(t),o.setTrip(n));var u=new Template({id:"photo_dialog",params:{trip_id:n.get("slug"),user_id:t.get("slug"),photo_id:o.get("slug")}});t.isCurrentUser()&&o.on("change",function(e,t){t.changes.title&&(elem.getElementsByTagName("h1").item(0).innerHTML=e.get("title"))}),e.loading("Loading photo"),u.load({success:function(n){var r=new Image;r.onload=function(){e.setView(n),e.autocenter();if(t.isCurrentUser()){var r=new PhotoForm({model:o,el:n});r.on("removed",function(){s.parentNode.removeChild(s),e.close(),o.destroy()}),r.render()}},r.src=n.getElementsByTagName("img").item(0).getAttribute("src")}})})}),window.addEventListener("DOMContentLoaded",function(){if(!/\strips\-maps\-index\s/.test(document.body.className))return}),window.addEventListener("DOMContentLoaded",function(){if(!/\strips\-show\s/.test(document.body.className))return;var e=document.getElementById("trip"),t=Trip.createFromDataAttribute(e),n=User.createFromDataAttribute(e,"data-user"),r=LocationsCollection.createFromDataAttribute(e,"data-locations"),i=MapsCollection.createFromDataAttribute(e,"data-maps"),s=null,o={zoom:10,draggable:!1,disableDefaultUI:!0},u=document.getElementById("trip-google-map");t.setUser(n),t.setLocations(r),t.setMaps
(i);var i=new TripMap({el:u,model:t});i.mergeMapOptions(o),i.render().drawMaps().drawLocations();var a=document.getElementsByClassName("photo");[].forEach.call(a,function(e,t){function i(){var n=e.parentNode,r=n.offsetWidth/2-e.offsetWidth/2,i=n.offsetHeight/2-e.offsetHeight/2,s=(Math.random()-.5)*45;r+=(Math.random()-.5)*n.offsetWidth,i+=(Math.random()-.5)*n.offsetHeight,e.style.left=r+"px",e.style.top=i+"px",e.style.webkitTransform="rotate("+s+"deg)",e.style.mozTransform="rotate("+s+"deg)",setTimeout(function(){e.style.opacity=1},100*t)}var n=new Image,r=e.getElementsByTagName("img").item(0);if(!r){i();return}n.onload=function(){i()},n.src=e.getElementsByTagName("img").item(0).getAttribute("src")})}),window.addEventListener("DOMContentLoaded",function(){if(!/\susers\-show\s/.test(document.body.className))return;var e=document.getElementById("user"),t=User.createFromDataAttribute(e),n=new TripsCollection,r=document.getElementById("map"),i=new GoogleMap({el:r});i.mergeMapOptions({disableDefaultUI:!0}),i.render(),t.setTrips(n),[].forEach.call(document.getElementsByClassName("trip"),function(e){var r=Trip.createFromDataAttribute(e),i=MapsCollection.createFromDataAttribute(e,"data-maps"),s=LocationsCollection.createFromDataAttribute(e,"data-locations"),o=new TripMap({el:e,model:r});r.setUser(t),r.setMaps(i),r.setLocations(s),o.addLocations(s,{silent:!0}),n.add(r)}),i.drawLocations(),i.on("location_mouseover",function(e){var t=e.marker;t.model.setUser(t.model.trip().user());var n=new LocationInfowindow({model:t.model,map:i.googleMap()});n.show()}),i.on("location_click",function(e){window.location.href=e.marker.model.trip().url()})}),window.addEventListener("DOMContentLoaded",function(){if(!/\welcome\-index\s/.test(document.body.className))return}),window.TA.countries=new CountryCollection,window.addEventListener("DOMContentLoaded",function(){if(!document.querySelector("#user-info .dropdown"))return;TA.currentUser&&!TA.currentUser.isAnonymous()&&(new DropDown({el:document.querySelector("#user-info .dropdown"),control:document.querySelector("#user-info .control")})).render()});