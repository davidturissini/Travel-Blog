<article id="location" data-location_type="<%= @location.location_type.to_json %>" data-json="<%= @location.to_json %>">
 <header>
  <h2 id="location-title"><%= @location.title %></h2>
  <%= @location.city %>, <%= @location.country %>
 </header>
 <figure id="hero-gallery">
  <%= image @location.photo_url, :id => "hero-large" %>
  <div id="location-photos">
   <ul id="location-thumbs">
 
   </ul>
  </div>
 </figure>
  <div id="map"></div>
 <section id="journal_entries">
  <% @location.journal_entries.each do |entry| %>
   <%= render "journal_entry", :entry => entry %>
  <% end %>
 </section>
 
 <br class="clear" />
 <% if current_user.owns?(@location) %>
    <div class="toolbox">
      <%= link_to "Edit #{@location.title}", edit_location_path(@location) %> |
      <%= link_to "Add new journal entry for #{@location.title}", new_user_location_type_location_journal_entry_path({
        :user_id => current_user.slug,
        :location_type_id => @location.location_type.slug,
        :location_id => @location.slug
        }), :class => "new-journal-entry-link"
      %>
    </div>
  <% end %>
</article>


<% content_for :scripts_footer do %>
 <script>
   window.addEventListener("DOMContentLoaded", function () {
   var loc = new Location(JSON.parse( document.getElementById("location").getAttribute("data-json") )),
   locationType = new Location(JSON.parse( document.getElementById("location").getAttribute("data-location_type") )),
   map = new google.maps.Map(document.getElementById("map"), {
     disableDefaultUI: true,
     zoom: 4,
     center: new google.maps.LatLng(loc.get("latitude"), loc.get("longitude")),
     mapTypeId: google.maps.MapTypeId.HYBRID
    })
   new LocationMarker({
    model:loc,
    map:map,
    locationType:locationType
   }).render()
   loc.photos({
    success:function (e) {
     var ul = document.getElementById("location-thumbs"),
     largeImage = document.getElementById("hero-large")
     e.photoset.photo.forEach(function (photo) {
      var image = new FlickrImage(photo),
      li = document.createElement("li"),
      img = document.createElement("img"),
      ulWidth = ul.offsetWidth
      img.setAttribute("src", image.url("s"))
      li.appendChild(img)
      ul.appendChild(li)
      ul.style.width = ulWidth + li.offsetLeft + "px"
      img.addEventListener("click", function () { 
       largeImage.setAttribute("src", image.url()) 
      })
     })
     new Scroller({
      el:document.getElementById("location-photos"),
      container:document.getElementById("location-thumbs"),
      items:document.getElementById("location-thumbs").getElementsByTagName("li")
     }).render()
    }
   }) 
   })
 </script>
<% end %>
